<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-big-counter.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Oracle,SQL,PL/SQL," />










<meta name="description" content="Oracle-SQL SQL语句分为以下三种类型：  DML 数据操纵语言 DML用于查询与修改数据记录；如INSERT、UPDATE、DELECT、SELECT   DDL 数据定义语言 DDL用于定义数据库的结构；如CREATE TABLE、ALTER TABLE、DROP TABLE、CREATE INDEX、DROP INDEX   DCL 数据控制语言 DCL用来控制数据库的访问；GRA">
<meta property="og:type" content="article">
<meta property="og:title" content="Oracle_SQL基础与PL&#x2F;SQL">
<meta property="og:url" content="http://yoursite.com/2022/09/04/Oracle-SQL%E5%9F%BA%E7%A1%80%E4%B8%8EPL-SQL/index.html">
<meta property="og:site_name" content="NoTrouble&#39;s Blog">
<meta property="og:description" content="Oracle-SQL SQL语句分为以下三种类型：  DML 数据操纵语言 DML用于查询与修改数据记录；如INSERT、UPDATE、DELECT、SELECT   DDL 数据定义语言 DDL用于定义数据库的结构；如CREATE TABLE、ALTER TABLE、DROP TABLE、CREATE INDEX、DROP INDEX   DCL 数据控制语言 DCL用来控制数据库的访问；GRA">
<meta property="og:locale">
<meta property="article:published_time" content="2022-09-04T15:55:42.000Z">
<meta property="article:modified_time" content="2022-09-04T15:55:42.000Z">
<meta property="article:author" content="NoTrouble">
<meta property="article:tag" content="Oracle">
<meta property="article:tag" content="SQL">
<meta property="article:tag" content="PL&#x2F;SQL">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2022/09/04/Oracle-SQL基础与PL-SQL/"/>





  <title>Oracle_SQL基础与PL/SQL | NoTrouble's Blog</title>
  








<meta name="generator" content="Hexo 5.4.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">NoTrouble's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">我们一路奋战，不是为了改变世界，而是为了不让世界改变我们</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-playlist">
          <a href="/playlist/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-music"></i> <br />
            
            歌单
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2022/09/04/Oracle-SQL%E5%9F%BA%E7%A1%80%E4%B8%8EPL-SQL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/wk.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NoTrouble's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Oracle_SQL基础与PL/SQL</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2022-09-04T23:55:42+08:00">
                2022-09-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SQL/" itemprop="url" rel="index">
                    <span itemprop="name">SQL</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><strong>Oracle-SQL</strong></p>
<p>SQL语句分为以下三种类型：</p>
<ol>
<li><strong>DML 数据操纵语言</strong><ol>
<li>DML用于查询与修改数据记录；如INSERT、UPDATE、DELECT、SELECT</li>
</ol>
</li>
<li><strong>DDL 数据定义语言</strong><ol>
<li>DDL用于定义数据库的结构；如CREATE TABLE、ALTER TABLE、DROP TABLE、CREATE INDEX、DROP INDEX</li>
</ol>
</li>
<li><strong>DCL 数据控制语言</strong><ol>
<li>DCL用来控制数据库的访问；GRANT、REVOKE、COMMIT、ROLLBACK、SAVEPOINT、LOCK</li>
</ol>
</li>
</ol>
<h2 id="1-基本的SQL-SELECT语句"><a href="#1-基本的SQL-SELECT语句" class="headerlink" title="1.基本的SQL-SELECT语句"></a>1.基本的SQL-SELECT语句</h2><h3 id="基本SELECT语句"><a href="#基本SELECT语句" class="headerlink" title="基本SELECT语句"></a>基本SELECT语句</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 选择哪些列</span><br><span class="line"><span class="keyword">FROM</span> 从个表中;</span><br></pre></td></tr></table></figure>

<p><strong>选择全部列</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> departments;</span><br></pre></td></tr></table></figure>
<span id="more"></span> 
<p><strong>选择特定的列</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_id, location_id</span><br><span class="line"><span class="keyword">FROM</span> departments;</span><br></pre></td></tr></table></figure>

<p><strong>数字和日期使用的算术运算符</strong><br>| 操作符 | 描述  |<br>| :—– | :—: |<br>| +      |  加   |<br>| -      |  减   |<br>| *      |  乘   |<br>| /      |  除   |<br><strong>操作符优先级</strong></p>
<ol>
<li>乘除优先级高于加减</li>
<li>同一优先级别运算符从左向右执行</li>
<li>括号内的运算先执行</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, salary, salary<span class="operator">*</span><span class="number">12</span><span class="operator">+</span><span class="number">1000</span>, <span class="number">12</span><span class="operator">*</span>(salary <span class="operator">+</span> <span class="number">1000</span>)</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<p>日期可以做加减，但是不可以进行乘和除。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> SYSDATE, SYSDATE <span class="operator">+</span> <span class="number">1</span>, SYSDATE<span class="number">-2</span> </span><br><span class="line"><span class="keyword">FROM</span> dual;</span><br></pre></td></tr></table></figure>

<h3 id="定义空值"><a href="#定义空值" class="headerlink" title="定义空值"></a>定义空值</h3><ol>
<li>空值是无效的，未指定的，未知的或不可预知的值</li>
<li>空值不是空格或者0</li>
</ol>
<p>空值不同于0，凡是空值参与的运算，结果都为空(NULL)。</p>
<h3 id="列的别名"><a href="#列的别名" class="headerlink" title="列的别名"></a>列的别名</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id id, last_name name, <span class="number">12</span><span class="operator">*</span>salary annual_sal</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>
<p>列的别名可以使用双引号</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id &quot;id&quot;, last_name &quot;name&quot;, <span class="number">12</span><span class="operator">*</span>salary &quot;annual_sal&quot;</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h3 id="连接符"><a href="#连接符" class="headerlink" title="连接符"></a>连接符</h3><ol>
<li>把列与列，列与字符连接在一起</li>
<li>用’||’表示</li>
<li>可以用来’合成’列</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name <span class="operator">||</span> <span class="string">&#x27;`s job_id is &#x27;</span> <span class="operator">||</span> job_id</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h3 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h3><ol>
<li>字符串可以是SELECT列表中的一个字符，数字，日期；</li>
<li>日期和字符只能在单引号中出现；</li>
<li>每当返回一行时，字符串被输出一次。</li>
</ol>
<h3 id="重复行"><a href="#重复行" class="headerlink" title="重复行"></a>重复行</h3><p>默认情况下，查询会返回全部行，包括重复行。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_id</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>
<p>使用DISTINCT关键字可以删除重复行。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> department_id</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>
<p>下列语法错误</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, <span class="keyword">DISTINCT</span> department_id</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h3 id="SQL-Plus命令"><a href="#SQL-Plus命令" class="headerlink" title="SQL*Plus命令"></a>SQL*Plus命令</h3><ol>
<li>一种环境</li>
<li>Oracle的特性之一</li>
<li>关键字可以缩写</li>
<li>命令不能改变数据库中的数据的值</li>
<li>集中运行</li>
</ol>
<h3 id="描述表的结构"><a href="#描述表的结构" class="headerlink" title="描述表的结构"></a>描述表的结构</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DESC</span>[RIBE] employees;</span><br></pre></td></tr></table></figure>

<h3 id="第一节测试"><a href="#第一节测试" class="headerlink" title="第一节测试"></a>第一节测试</h3><ol>
<li>SQL*PLUS命令可以控制数据库吗？ 不可以！</li>
<li>下面的语句是否可以执行成功： 可以<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, job_id, salary <span class="keyword">AS</span> sal</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure></li>
<li>下面的语句是否可以执行成功： 可以<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure></li>
<li>找出下面语句中的错误：标点符号需要英文格式；双引号也需要英文格式<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name，salary<span class="operator">*</span><span class="number">12</span> “ANNUAL SALARY”;</span><br></pre></td></tr></table></figure></li>
<li>显示表departments的结构，并查询其中的全部数据<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DESC</span> employees;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> departments;</span><br></pre></td></tr></table></figure></li>
<li>显示出employees中的全部job_id（不能重复）<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> job_id <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure></li>
<li>显示出表employees的全部列，各个列之间用都逗号连接，列头显示成OUT_PUT<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id <span class="operator">||</span> <span class="string">&#x27;,&#x27;</span> <span class="operator">||</span>last_name<span class="operator">||</span> <span class="string">&#x27;,&#x27;</span> <span class="operator">||</span> salary &quot;OUT_PUT&quot;</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="2-过滤和排序数据"><a href="#2-过滤和排序数据" class="headerlink" title="2.过滤和排序数据"></a>2.过滤和排序数据</h2><p>学习目标：</p>
<ol>
<li>在查询中过滤行；</li>
<li>在查询中对行进行排序。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> employee_id <span class="operator">&gt;</span> <span class="number">200</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> <span class="number">5000</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="operator">=</span> <span class="number">90</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> last_name <span class="operator">=</span> <span class="string">&#x27;higgins&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>字符和日期</strong></p>
<ol>
<li>字符和日期要包含在单引号中；</li>
<li>字符大小写敏感，日期格式敏感；</li>
</ol>
<h3 id="比较运算"><a href="#比较运算" class="headerlink" title="比较运算"></a>比较运算</h3><table>
<thead>
<tr>
<th align="center">操作符</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">=</td>
<td align="center">等于</td>
</tr>
<tr>
<td align="center">&gt;</td>
<td align="center">大于</td>
</tr>
<tr>
<td align="center">&gt;=</td>
<td align="center">大于等于</td>
</tr>
<tr>
<td align="center">&lt;</td>
<td align="center">小于</td>
</tr>
<tr>
<td align="center">&lt;=</td>
<td align="center">小于等于</td>
</tr>
<tr>
<td align="center">&lt;&gt;</td>
<td align="center">不等于</td>
</tr>
<tr>
<td align="center">!=</td>
<td align="center">不等于</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, hire_date, salary</span><br><span class="line"><span class="keyword">FROM</span> empolyees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;=</span> <span class="number">4000</span></span><br><span class="line"><span class="keyword">AND</span> salary <span class="operator">&lt;</span> <span class="number">7000</span></span><br></pre></td></tr></table></figure>

<h3 id="其它比较运算符"><a href="#其它比较运算符" class="headerlink" title="其它比较运算符"></a>其它比较运算符</h3><table>
<thead>
<tr>
<th align="left">操作符</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left">BETWEEN… AND …</td>
<td align="center">在两个值之间(包含边界)</td>
</tr>
<tr>
<td align="left">IN(set)</td>
<td align="center">等于值列表中的一个</td>
</tr>
<tr>
<td align="left">LIKE</td>
<td align="center">模糊查询</td>
</tr>
<tr>
<td align="left">IS NULL</td>
<td align="center">为空值</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, hire_date, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="keyword">BETWEEN</span> <span class="number">4000</span> <span class="keyword">AND</span> <span class="number">7000</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, hire_date, salary, department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="keyword">IN</span> (<span class="number">90</span>, <span class="number">80</span>, <span class="number">70</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, department_id, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">&#x27;%a%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, department_id, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">&#x27;_a%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, department_id, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">&#x27;%\_%&#x27;</span> <span class="keyword">ESCAPE</span> <span class="string">&#x27;\&#x27;</span>; </span><br></pre></td></tr></table></figure>

<h3 id="逻辑运算"><a href="#逻辑运算" class="headerlink" title="逻辑运算"></a>逻辑运算</h3><table>
<thead>
<tr>
<th align="left">操作符</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left">AND</td>
<td align="center">逻辑与</td>
</tr>
<tr>
<td align="left">OR</td>
<td align="center">逻辑或</td>
</tr>
<tr>
<td align="left">NOT</td>
<td align="center">逻辑非</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, hire_date, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="operator">=</span> <span class="number">80</span> <span class="keyword">AND</span> salary <span class="operator">&lt;=</span> <span class="number">5000</span>;</span><br></pre></td></tr></table></figure>

<p><strong>优先级</strong><br>| 优先级 |                             |<br>| :—– | :————————-: |<br>| 1      |         算术运算符          |<br>| 2      |           连接符            |<br>| 3      |           比较符            |<br>| 4      | IS[NOT] NULL, LIKE, [NOT]IN |<br>| 5      |        NOT[BETWEEN]         |<br>| 6      |             NOT             |<br>| 7      |             AND             |<br>| 8      |             OR              |<br>括号可以改变优先级顺序</p>
<h3 id="ORDER-BY子句"><a href="#ORDER-BY子句" class="headerlink" title="ORDER BY子句"></a>ORDER BY子句</h3><p>使用ORDER BY子句排序：<br>-ASC:升序<br>-DESC：降序<br>ORDER BY子句在SELECT语句的<strong>结尾</strong>。默认为升序排序</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, department_id, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, department_id, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">ASC</span>, last_name <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<h3 id="第二节总结"><a href="#第二节总结" class="headerlink" title="第二节总结"></a>第二节总结</h3><ol>
<li>使用WHERE子句过滤数据<ol>
<li>使用比较运算符</li>
<li>使用BETWEEN AND, IN, LIKE和NULL运算</li>
<li>使用逻辑运算符AND，OR和NOT</li>
</ol>
</li>
<li>使用ORDER BY子句进行排序</li>
</ol>
<h3 id="第二节测试"><a href="#第二节测试" class="headerlink" title="第二节测试"></a>第二节测试</h3><ol>
<li><p>WHERE子句紧随FROM子句  正确</p>
</li>
<li><p>查询 last_name 为 ‘King’的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> first_name, last_name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> last_name <span class="operator">=</span> king;</span><br></pre></td></tr></table></figure>
<p>错误，King上没有加单引号；且单引号中的值区分大小写。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> first_name, last_name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> last_name <span class="operator">=</span> <span class="string">&#x27;King&#x27;</span>;</span><br></pre></td></tr></table></figure></li>
<li><p>查询1998-4-24来公司的员工有哪些？</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, hire_date</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> TO_CHAR(hire_date, <span class="string">&#x27;yyyy-mm-dd&#x27;</span>) <span class="operator">=</span> <span class="string">&#x27;1998-04-24&#x27;</span>;</span><br></pre></td></tr></table></figure></li>
<li><p>查询工资在5000—10000之间的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="comment">-- WHERE salary &gt;= 5000 AND salary &lt;= 10000;</span></span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="keyword">BETWEEN</span> <span class="number">5000</span> <span class="keyword">AND</span> <span class="number">10000</span>;</span><br></pre></td></tr></table></figure></li>
<li><p>查询工资等于6000，7000，8000，9000，10000的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="comment">-- WHERE salary = 6000 OR salary = 7000 OR salary = 8000 OR salary = 9000 OR salary = 10000;</span></span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="keyword">IN</span>(<span class="number">6000</span>, <span class="number">7000</span>, <span class="number">8000</span>, <span class="number">9000</span>, <span class="number">10000</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>查询LAST_NAME 中有’o’字符的所有员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">&#x27;%o%&#x27;</span>;</span><br></pre></td></tr></table></figure></li>
<li><p>查询LAST_NAME 中第二个字符是’o’字符的所有员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">&#x27;_o%&#x27;</span>;</span><br></pre></td></tr></table></figure></li>
<li><p>查询LAST_NAME中含有’_’字符的所有员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">&#x27;%\_%&#x27;</span> <span class="keyword">ESCAPE</span> <span class="string">&#x27;\&#x27;</span>;</span><br></pre></td></tr></table></figure></li>
<li><p>查询COMMISSION_PCT字段为空的所有员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, commission_pct</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> commission_pct <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="3-单行函数"><a href="#3-单行函数" class="headerlink" title="3.单行函数"></a>3.单行函数</h2><p>学习目标：</p>
<ol>
<li>SQL中不同类型的函数</li>
<li>在SELECT语句中使用字符，数字，日期和<strong>转换函数</strong></li>
<li>使用条件表达式</li>
</ol>
<p><strong>单行函数的分类</strong><br>字符、数值、日期、转换、通用</p>
<h3 id="字符函数"><a href="#字符函数" class="headerlink" title="字符函数"></a>字符函数</h3><h4 id="大小写控制函数"><a href="#大小写控制函数" class="headerlink" title="大小写控制函数"></a>大小写控制函数</h4><p>LOWER、UPPER、INITCAP</p>
<table>
<thead>
<tr>
<th align="left">函数</th>
<th align="center">结果</th>
</tr>
</thead>
<tbody><tr>
<td align="left">LOWER(‘SQL Course’)</td>
<td align="center">sql course</td>
</tr>
<tr>
<td align="left">UPPER(‘SQL Course’)</td>
<td align="center">SQL COURSE</td>
</tr>
<tr>
<td align="left">INITCAP</td>
<td align="center">Sql Course</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> <span class="built_in">LOWER</span>(last_name) <span class="operator">=</span> <span class="string">&#x27;king&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h4 id="字符控制函数"><a href="#字符控制函数" class="headerlink" title="字符控制函数"></a>字符控制函数</h4><table>
<thead>
<tr>
<th align="left">函数</th>
<th align="center">结果</th>
</tr>
</thead>
<tbody><tr>
<td align="left">CONCAT(‘Hello’, ‘World’)</td>
<td align="center">HelloWorld</td>
</tr>
<tr>
<td align="left">SUBSTR(‘HelloWorld’,2,4)</td>
<td align="center">ello</td>
</tr>
<tr>
<td align="left">LENGTH(‘HelloWorld’)</td>
<td align="center">10</td>
</tr>
<tr>
<td align="left">INSTR(‘HelloWorld’, ‘W’)</td>
<td align="center">6</td>
</tr>
<tr>
<td align="left">LPAD(salary,10,’*’)</td>
<td align="center">*****24000</td>
</tr>
<tr>
<td align="left">RPAD(salary,10,’*’)</td>
<td align="center">24000*****</td>
</tr>
<tr>
<td align="left">TRIM(‘H’ FROM ‘HelloWorld’)</td>
<td align="center">elloWorld (去除首尾)</td>
</tr>
<tr>
<td align="left">REPLACE(‘abcd’,’b’,’m’)</td>
<td align="center">amcd (替换所有)</td>
</tr>
</tbody></table>
<h4 id="数字函数"><a href="#数字函数" class="headerlink" title="数字函数"></a>数字函数</h4><ol>
<li>ROUND：四舍五入；ROUND(45.926, 2) -&gt; 45.93</li>
<li>TRUNC: 截断；TRUNC(45.926, 2) -&gt; 45.92</li>
<li>MOD: 求余； MOD(1600, 300) -&gt; 100</li>
</ol>
<p>ROUND(435.45,2) -&gt; 435.45; ROUND(435.45) -&gt; 435; ROUND(435.45, -2) -&gt; 400</p>
<h4 id="日期函数"><a href="#日期函数" class="headerlink" title="日期函数"></a>日期函数</h4><ol>
<li>Oracle中的日期型数据实际含有两个值；日期和时间</li>
</ol>
<p>函数SYSDATE返回：日期、时间</p>
<p><strong>日期的数学运算</strong></p>
<ol>
<li>在日期上加上或减去一个数字结果仍为日期</li>
<li>两个日期相减返回日期之间相差的<strong>天数</strong>。日期不允许做加法运算，无意义。</li>
<li>可以用数字除24来向日期中加上或减去天数</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> SYSDATE, SYSDATE<span class="operator">+</span><span class="number">1</span>, SYSDATE<span class="number">-3</span></span><br><span class="line"><span class="keyword">FROM</span> dual;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, TRUNC(SYSDATE <span class="operator">-</span> hire_date) worked_days</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<p><strong>日期函数</strong><br>| 函数           |              描述              |<br>| :————- | :—————————-: |<br>| MONTHS_BETWEEN |       两个日期相差的月数       |<br>| ADD_MONTHS     |    向指定日期中加上若干月数    |<br>| NEXT_DAY       | 指定日期的下一个星期对应的日期 |<br>| LAST_DAY       |         本月的最后一天         |<br>| ROUND          |          日期四舍五入          |<br>| TRUNC          |            日期截断            |</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, MONTHS_BETWEEN(SYSDATE, hire_date)</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ADD_MONTHS(SYSDATE, <span class="number">2</span>), ADD_MONTHS(SYSDATE, <span class="number">-3</span>), NEXT_DAY(SYSDATE, <span class="string">&#x27;星期日&#x27;</span>)</span><br><span class="line"><span class="keyword">FROM</span> dual;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--来公司的员工中，hire_date是每个月倒数第二天来公司的有哪些？</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name, hire_date</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">where</span> hire_date <span class="operator">=</span> LAST_DAY(hire_date)<span class="number">-1</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ROUND(SYSDATE, <span class="string">&#x27;month&#x27;</span>), ROUND(SYSDATE, <span class="string">&#x27;mm&#x27;</span>), TRUNC(SYSDATE, <span class="string">&#x27;hh&#x27;</span>)</span><br><span class="line"><span class="keyword">FROM</span> dual;</span><br></pre></td></tr></table></figure>

<h4 id="转换函数"><a href="#转换函数" class="headerlink" title="转换函数"></a>转换函数</h4><ol>
<li>隐性</li>
<li>显性</li>
</ol>
<p>隐式数据类型转换：Oracle自动完成转换<br>| 源数据类型       | 目标数据类型 |<br>| :————— | :———-: |<br>| VARCHAR2 or CHAR |    NUMBER    |<br>| VARCHAR2 or CHAR |     DATE     |<br>| NUMBER           |   VARCHAR2   |<br>| DATE             |   VARCHAR2   |</p>
<p>DATE &lt;-&gt; VARCHAR2 &lt;-&gt; NUMBER</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;12&#x27;</span> <span class="operator">+</span> <span class="number">2</span> <span class="keyword">FROM</span> dual;</span><br><span class="line"><span class="comment">--14</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> SYSDATE <span class="operator">+</span> <span class="string">&#x27;2&#x27;</span> <span class="keyword">FROM</span> dual;</span><br></pre></td></tr></table></figure>

<p>显示数据类型转换</p>
<ol>
<li>CHARACTER ——TO_DATE——&gt; DATE</li>
<li>CHARACTER ——TO_NUMBER——&gt; NUMBER</li>
<li>DATE —— TO_CHAR ——&gt; CHARCTER</li>
<li>NUMBER ——TO_CHAR ——&gt; CHARCTER</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, hire_date</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> TO_CHAR(hire_date,<span class="string">&#x27;yyyy-mm-dd&#x27;</span>) <span class="operator">=</span> <span class="string">&#x27;1996-02-03&#x27;</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, hire_date</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> TO_CHAR(hire_date,<span class="string">&#x27;yyyy&quot;年&quot;mm&quot;月&quot;dd&quot;日&quot;&#x27;</span>) <span class="operator">=</span> <span class="string">&#x27;1996年02月03日&#x27;</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, hire_date</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> hire_date <span class="operator">=</span> TO_DATE(<span class="string">&#x27;1996-02-03&#x27;</span>,<span class="string">&#x27;yyyy-mm-dd&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>TO_CHAR函数对数字的转换:<br>| 标识 |     说明     |<br>| :— | :———-: |<br>| 9    |     数字     |<br>| 0    |      零      |<br>| $    |    美元符    |<br>| L    | 本地货币符号 |<br>| .    |    小数点    |<br>| ,    |    千位符    |</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TO_CHAR(<span class="number">1234567.89</span>, <span class="string">&#x27;999,999,999.99&#x27;</span>) <span class="keyword">FROM</span> dual;</span><br><span class="line"><span class="comment">-- 1,234,567.89 </span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TO_CHAR(<span class="number">1234567.89</span>, <span class="string">&#x27;000,000,999.99&#x27;</span>) <span class="keyword">FROM</span> dual;</span><br><span class="line"><span class="comment">-- 001,234,567.89 </span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TO_CHAR(<span class="number">1234567.89</span>, <span class="string">&#x27;$000,000,999.99&#x27;</span>) <span class="keyword">FROM</span> dual;</span><br><span class="line"><span class="comment">-- $001,234,567.89 </span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TO_CHAR(<span class="number">1234567.89</span>, <span class="string">&#x27;L000,000,999.99&#x27;</span>) <span class="keyword">FROM</span> dual;</span><br><span class="line"><span class="comment">-- ￥001,234,567.89 </span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TO_NUMBER(<span class="string">&#x27;￥001,234,567.89&#x27;</span>, <span class="string">&#x27;L000,000,999.99&#x27;</span>) <span class="keyword">FROM</span> dual;</span><br><span class="line"><span class="comment">-- ￥1234567.89</span></span><br></pre></td></tr></table></figure>

<h4 id="通用函数"><a href="#通用函数" class="headerlink" title="通用函数"></a>通用函数</h4><p>这些函数适用于任何数据类型，同时也适用于空值：</p>
<ol>
<li>NVL(expr1, expr2)</li>
<li>NVL2(expr1, expr2, expr3)；expr1不为NULL，返回expr2,若为NULL，返回expr3</li>
<li>NULLIF(expr1, expr2)；相等返回NULL，不相等返回expr1</li>
<li>COALESCE(expr1,expr2,…,exprn)；COALESCE与NVL相比的优点在于COALESCE可以同时处理交替的多个值，如果第一个表达式为空，则返回下一个表达式，对其他的参数进行COALESCE</li>
</ol>
<p>NVL函数：将空值转换成一个已知的值：</p>
<ol>
<li>可以使用的数据类型有日期、字符、数字。</li>
<li>函数的一般形式：<ol>
<li>-NVL(commission_pct, 0)</li>
<li>-NVL(hire_date, ‘01-JAN-97’)</li>
<li>-NVL(job_id, ‘NO Job Yet’)</li>
</ol>
</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 求公司员工的年薪(含commission_pct)</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id, </span><br><span class="line">last_name, </span><br><span class="line">salary <span class="operator">*</span> <span class="number">12</span> <span class="operator">*</span>(<span class="number">1</span> <span class="operator">+</span> NVL(commission_pct, <span class="number">0</span>))</span><br><span class="line"><span class="keyword">FROM</span> employess;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 输出last_name,department_id，当department_id为NULL时，显示&#x27;没有部门&#x27;。</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name, NVL(TO_CHAR(department_id, <span class="string">&#x27;999999&#x27;</span>), <span class="string">&#x27;没有部门&#x27;</span>)</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询员工的奖金率，若为空，返回0.01；若不为空，则返回实际的奖金率+0.015</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name, commission_pct, NVL2(commission_pct, commission_pct<span class="operator">+</span><span class="number">0</span>,<span class="number">015</span>, <span class="number">0</span>,<span class="number">01</span>)</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h3 id="条件表达式"><a href="#条件表达式" class="headerlink" title="条件表达式"></a>条件表达式</h3><ol>
<li>在SQL语句中使用IF-THEN-ELSE逻辑</li>
<li>使用两种方法：<ol>
<li>-CASE表达式</li>
<li>-DECODE函数</li>
</ol>
</li>
</ol>
<p>CASE表达式：在需要使用IF-THEN-ELSE逻辑时：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CASE</span> expr <span class="keyword">WHEN</span> comparison_expr1 <span class="keyword">THEN</span> return_expr1</span><br><span class="line">   [<span class="keyword">WHEN</span> comparison_expr2 <span class="keyword">THEN</span> return_expr2</span><br><span class="line">   <span class="keyword">WHEN</span> comparison_exprn <span class="keyword">THEN</span> return_exprn</span><br><span class="line">   <span class="keyword">ELSE</span> else_expr]</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询部门号为10，20，30 的员工信息, 若部门号为10，则打印其工资的1.1倍；</span></span><br><span class="line"><span class="comment">-- 若20部门则打印其工资的1.2倍；</span></span><br><span class="line"><span class="comment">-- 若30部门打印其工资的1.3倍</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, department_id, </span><br><span class="line"><span class="keyword">CASE</span> department_id </span><br><span class="line">   <span class="keyword">WHEN</span> <span class="number">10</span> <span class="keyword">THEN</span> salary <span class="operator">*</span> <span class="number">1.1</span></span><br><span class="line">   <span class="keyword">WHEN</span> <span class="number">20</span> <span class="keyword">THEN</span> salary <span class="operator">*</span> <span class="number">1.2</span></span><br><span class="line">   <span class="keyword">WHEN</span> <span class="number">30</span> <span class="keyword">THEN</span> salary <span class="operator">*</span> <span class="number">1.3</span></span><br><span class="line">   <span class="keyword">ELSE</span> salary</span><br><span class="line"><span class="keyword">END</span> new_sal</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="keyword">IN</span> (<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>);</span><br></pre></td></tr></table></figure>

<p>DECODE函数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, job_id, salary</span><br><span class="line">   DECODE(job_id, <span class="string">&#x27;IT_PROG&#x27;</span>, <span class="number">1.10</span> <span class="operator">*</span> salary,</span><br><span class="line">                  <span class="string">&#x27;ST_CLERK&#x27;</span>, <span class="number">1.15</span> <span class="operator">*</span> salary,</span><br><span class="line">                  <span class="string">&#x27;SA_REP&#x27;</span>, <span class="number">1.20</span> <span class="operator">*</span> salary,</span><br><span class="line">                            salary) REVISED_SALARY</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name,</span><br><span class="line">      DECODE(department_id, <span class="number">10</span>, <span class="number">1.1</span> <span class="operator">*</span> salary,</span><br><span class="line">                            <span class="number">20</span>, <span class="number">1.2</span> <span class="operator">*</span> salary,</span><br><span class="line">                            <span class="number">30</span>, <span class="number">1.3</span> <span class="operator">*</span> salary</span><br><span class="line">                            salary) new_sal</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="keyword">IN</span> (<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>);  </span><br></pre></td></tr></table></figure>

<h2 id="4-多表查询"><a href="#4-多表查询" class="headerlink" title="4.多表查询"></a>4.多表查询</h2><p>学习目标：</p>
<ol>
<li>使用等值或不等值连接在SELECT语句中查询多个表中的数据</li>
<li>使用自连接</li>
<li>使用外连接查询不满足连接条件的数据</li>
</ol>
<h3 id="笛卡尔积"><a href="#笛卡尔积" class="headerlink" title="笛卡尔积"></a>笛卡尔积</h3><p>笛卡尔积会在下面条件下产生：</p>
<ol>
<li>省略连接条件</li>
<li>连接条件无效</li>
<li>所有表中的所有行互相连接</li>
</ol>
<p>为了避免笛卡尔积，可以在WHERE加入有效的连接条件。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.employee_id, d.department_id, d.department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e, departments d</span><br><span class="line"><span class="keyword">WHERE</span> e.department_id <span class="operator">=</span> d.department_id;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.employee_id, d.department_id, d.department_name l.city</span><br><span class="line"><span class="keyword">FROM</span> employees e, departments d, locations l</span><br><span class="line"><span class="keyword">WHERE</span> e.department_id <span class="operator">=</span> d.department_id <span class="keyword">AND</span> d.location_id <span class="operator">=</span> l.location_id;</span><br></pre></td></tr></table></figure>
<h3 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h3><h4 id="内连接"><a href="#内连接" class="headerlink" title="内连接"></a>内连接</h4><p><strong>等值连接</strong><br>连接N个表，至少需要N-1个连接条件。例如：连接三个表，至少需要两个连接条件。</p>
<p><strong>非等值连接</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, grade_level</span><br><span class="line"><span class="keyword">FROM</span> employees e, job_grades j</span><br><span class="line"><span class="keyword">WHERE</span> e.salary <span class="keyword">BETWEEN</span> j.lowest_sal <span class="keyword">AND</span> j.highest_sal</span><br></pre></td></tr></table></figure>

<h4 id="外连接"><a href="#外连接" class="headerlink" title="外连接"></a>外连接</h4><ol>
<li>内连接：合并具有同一列的两个以上的表的行，结果集不包含一个表与另一个表不匹配的行</li>
<li>外连接：两个表在连接过程中除了返回满足连接条件的行以外还返回左(或右)表中不满足条件的行，这种连接称为左(或右)外连接。没有匹配的行时，结果表中相应的列为空(NULL)。外连接的WHERE子句条件类似于内部链接，但连接条件中没有匹配行的表的列后面要加外连接运算符，即用圆括号括起来的加号(+)。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 左外连接</span></span><br><span class="line"><span class="keyword">SELECT</span> e.employee_id, d.department_id, d.department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e, departments d</span><br><span class="line"><span class="keyword">WHERE</span> e.department_id <span class="operator">=</span> d.department_id(<span class="operator">+</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 右外连接</span></span><br><span class="line"><span class="keyword">SELECT</span> e.employee_id, d.department_id, d.department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e, departments d</span><br><span class="line"><span class="keyword">WHERE</span> e.department_id(<span class="operator">+</span>) <span class="operator">=</span> d.department_id;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 左外连接</span></span><br><span class="line"><span class="keyword">SELECT</span> e.employee_id, d.department_id, d.department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e <span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.department_id <span class="operator">=</span> d.department_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 右外连接</span></span><br><span class="line"><span class="keyword">SELECT</span> e.employee_id, d.department_id, d.department_name</span><br><span class="line"><span class="keyword">FROM</span> employees <span class="keyword">RIGHT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.department_id <span class="operator">=</span> d.department_id;</span><br></pre></td></tr></table></figure>

<h4 id="自然连接"><a href="#自然连接" class="headerlink" title="自然连接"></a>自然连接</h4><p>自然连接按照所有的相同字段名进行筛选</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, department_id, department_name</span><br><span class="line"><span class="keyword">FROM</span> employees <span class="keyword">NATURAL</span> <span class="keyword">JOIN</span> departments</span><br></pre></td></tr></table></figure>

<h4 id="全连接"><a href="#全连接" class="headerlink" title="全连接"></a>全连接</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.employee_id, d.department_id, d.department_name</span><br><span class="line"><span class="keyword">FROM</span> employees <span class="keyword">FULL</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.department_id <span class="operator">=</span> d.department_id;</span><br></pre></td></tr></table></figure>

<h4 id="自连接"><a href="#自连接" class="headerlink" title="自连接"></a>自连接</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询公司中员工&#x27;Chen&#x27;的manager的信息</span></span><br><span class="line"><span class="keyword">SELECT</span> emp.last_name, mana.last_name, mana.salary, mana.email</span><br><span class="line"><span class="keyword">FROM</span> employees emp, employees mana</span><br><span class="line"><span class="keyword">WHERE</span> emp.manager_id <span class="operator">=</span> mana.employee_id <span class="keyword">AND</span> <span class="built_in">LOWER</span>(emp.last_name) <span class="operator">=</span> <span class="string">&#x27;chen&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="5-聚合函数"><a href="#5-聚合函数" class="headerlink" title="5.聚合函数"></a>5.聚合函数</h2><p><strong>什么是聚合函数</strong><br>聚合函数作用于一组数据，并对一组数据返回一个值。</p>
<p>学习目标：</p>
<ol>
<li>了解聚合函数</li>
<li>描述聚合函数的用途</li>
<li>使用GROUP BY子句对数据分组</li>
<li>使用HAVING子句过滤分组结果集</li>
</ol>
<p>聚合函数类型：</p>
<ol>
<li>AVG</li>
<li>COUNT：返回表中记录总数</li>
<li>MAX</li>
<li>MIN</li>
<li>STDDEV：求标准差,可以做聚集和分析函数</li>
<li>SUM</li>
</ol>
<h3 id="AVG、SUM函数"><a href="#AVG、SUM函数" class="headerlink" title="AVG、SUM函数"></a>AVG、SUM函数</h3><p>AVG和SUM可以用于<strong>数值型数据</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary), <span class="built_in">SUM</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h3 id="MIN、MAX函数"><a href="#MIN、MAX函数" class="headerlink" title="MIN、MAX函数"></a>MIN、MAX函数</h3><p>MAX和MIN可以用于<strong>任意数据类型</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MAX</span>(last_name), <span class="built_in">MIN</span>(last_name), <span class="built_in">MAX</span>(hire_date), <span class="built_in">MIN</span>(hire_date)</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>
<h3 id="COUNT函数"><a href="#COUNT函数" class="headerlink" title="COUNT函数"></a>COUNT函数</h3><p>COUNT(<em>)适用于*<em>任意数据类型</em></em></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="number">1</span>), <span class="built_in">COUNT</span>(<span class="number">2</span>), <span class="built_in">COUNT</span>(<span class="operator">*</span>)</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<p>COUNT：计数函数<br>COUNT(expr) 返回expr<strong>不为空</strong>的记录总数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(commission_pct)</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(commission_pct), <span class="built_in">SUM</span>(commission_pct) <span class="operator">/</span> <span class="built_in">COUNT</span>(commission_pct), <span class="built_in">SUM</span>(commission_pct) <span class="operator">/</span> <span class="built_in">COUNT</span>(NVL(commission_pct, <span class="number">1</span>));</span><br></pre></td></tr></table></figure>
<p>COUNT(DISTINCT expr)：返回expr非空且不重复的记录总数。</p>
<h3 id="聚合数据"><a href="#聚合数据" class="headerlink" title="聚合数据"></a>聚合数据</h3><p>GROUP BY 字句语法<br>可以使用GROUP BY子句将表中的数据分成若干组</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">column</span>, group_function(<span class="keyword">column</span>)</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">table</span></span><br><span class="line">[<span class="keyword">WHERE</span> <span class="keyword">condition</span>]</span><br><span class="line">[<span class="keyword">GROUP</span> <span class="keyword">BY</span> group_by_expression]</span><br><span class="line">[<span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">column</span>];</span><br></pre></td></tr></table></figure>

<p>在SELECT列表中所有未包含在聚合函数中的列都应该包含在GROUP BY 子句中。<br>包含在GROUP BY子句中的列不必含在SELECT列表中。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 求出employees表中各部门的平均工资</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> department_id, <span class="built_in">AVG</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id;</span><br></pre></td></tr></table></figure>

<p>多层分组</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_id, job_id, <span class="built_in">AVG</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id, job_id</span><br></pre></td></tr></table></figure>

<p><strong>非法使用聚合函数</strong></p>
<ol>
<li>所有包含于SELECT列表中，而未包含于聚合函数中的列都必须包含于GRPOU BY子句中。</li>
<li>不能在WHERE子句中使用聚合函数。</li>
</ol>
<p>可以在HAVING子句中使用聚合函数。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 求出各部门中平均工资大于6000的部门，以及其平均工资</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> department_id, <span class="built_in">AVG</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">AVG</span>(salary) <span class="operator">&gt;</span> <span class="number">6000</span>;</span><br></pre></td></tr></table></figure>

<p>嵌套聚合函数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 显示各部门平均工资的最大值</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MAX</span>(<span class="built_in">AVG</span>(salary))</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id;</span><br></pre></td></tr></table></figure>

<h2 id="6-子查询"><a href="#6-子查询" class="headerlink" title="6.子查询"></a>6.子查询</h2><p>学习目标：</p>
<ol>
<li>描述子查询可以解决的问题</li>
<li>定义子查询</li>
<li>列出子查询的类型</li>
<li>书写单行子查询和多行子查询</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 谁的工资比Abel高</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> last_name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> (</span><br><span class="line">   <span class="keyword">SELECT</span> salary</span><br><span class="line">   <span class="keyword">FROM</span> employess</span><br><span class="line">   <span class="keyword">WHERE</span> last_name <span class="operator">=</span> <span class="string">&#x27;Abel&#x27;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="子查询语法"><a href="#子查询语法" class="headerlink" title="子查询语法"></a>子查询语法</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> select_list</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">table</span></span><br><span class="line"><span class="keyword">WHERE</span> expr operator</span><br><span class="line">   (</span><br><span class="line">      <span class="keyword">SELECT</span> select_list</span><br><span class="line">      <span class="keyword">FROM</span> <span class="keyword">table</span></span><br><span class="line">   )</span><br></pre></td></tr></table></figure>
<ol>
<li>子查询(内查询)在主查询之前一次执行完成。</li>
<li>子查询的结果被主查询(外查询)使用。</li>
</ol>
<p><strong>注意事项</strong></p>
<ol>
<li>子查询要包含在括号内</li>
<li>将子查询放在比较条件的右侧</li>
<li>单行操作符对应单行子查询，多行操作符对应多行子查询</li>
</ol>
<h3 id="单行子查询"><a href="#单行子查询" class="headerlink" title="单行子查询"></a>单行子查询</h3><ol>
<li>只返回一行</li>
<li>使用单行比较操作符(=,&gt;,&gt;=,&lt;,&lt;=,&lt;&gt;)</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 返回job_id与141员工相同，salary比143员工多的员工姓名，job_id和工资</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> last_name, job_id, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> job_id <span class="operator">=</span> (</span><br><span class="line">   <span class="keyword">SELECT</span> job_id</span><br><span class="line">   <span class="keyword">FROM</span> employees</span><br><span class="line">   <span class="keyword">WHERE</span> employee_id <span class="operator">=</span> <span class="number">141</span></span><br><span class="line">) <span class="keyword">AND</span> salary <span class="operator">&gt;</span> (</span><br><span class="line">   <span class="keyword">SELECT</span> salary</span><br><span class="line">   <span class="keyword">FROM</span> employees</span><br><span class="line">   <span class="keyword">WHERE</span> employees_id <span class="operator">=</span> <span class="number">143</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 返回公司工资最少的员工的last_name, job_id和salary</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> last_name, job_id, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">=</span> (</span><br><span class="line">   <span class="keyword">SELECT</span> <span class="built_in">MIN</span>(salary)</span><br><span class="line">   <span class="keyword">FROM</span> employees</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询最低工资大于50号部门最低工资的部门id和其最低工资</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> department_id, <span class="built_in">MIN</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">MIN</span>(salary) <span class="operator">&gt;</span> (</span><br><span class="line">   <span class="keyword">SELECT</span> <span class="built_in">MIN</span>(salary)</span><br><span class="line">   <span class="keyword">FROM</span> employees</span><br><span class="line">   <span class="keyword">WHERE</span> department_id <span class="operator">=</span> <span class="number">50</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><strong>非法使用子查询</strong></p>
<ol>
<li>多行子查询使用单行比较符</li>
<li>子查询中的空值问题(子查询不返回任何行)</li>
</ol>
<h3 id="多行子查询"><a href="#多行子查询" class="headerlink" title="多行子查询"></a>多行子查询</h3><ol>
<li>返回多行</li>
<li>使用多行比较操作符(IN(等于列表中的任意一个),ANY(和子查询返回的某一个值比较),ALL(和子查询返回的所有值比较))</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 返回其它部门中比job_id为‘IT_PROG’部门任一工资低的员工的员工号，姓名，job_id以及salary</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, job_id, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> job_id <span class="operator">&lt;&gt;</span> <span class="string">&#x27;IT_PROG&#x27;</span> <span class="keyword">AND</span></span><br><span class="line">salary <span class="operator">&lt;</span> <span class="keyword">ANY</span> (</span><br><span class="line">   <span class="keyword">SELECT</span> salary</span><br><span class="line">   <span class="keyword">FROM</span> employees</span><br><span class="line">   <span class="keyword">WHERE</span> job_id <span class="operator">=</span> <span class="string">&#x27;IT_PROG&#x27;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 返回其它部门中比job_id为‘IT_PROG’部门所有工资低的员工的员工号，姓名，job_id以及salary</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name,salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> job_id <span class="operator">&lt;&gt;</span> <span class="string">&#x27;IT_PROG&#x27;</span> <span class="keyword">AND</span></span><br><span class="line">salary <span class="operator">&lt;</span> <span class="keyword">ALL</span> (</span><br><span class="line">   <span class="keyword">SELECT</span> salary</span><br><span class="line">   <span class="keyword">FROM</span> employees</span><br><span class="line">   <span class="keyword">WHERE</span> job_id <span class="operator">=</span> <span class="string">&#x27;IT_PROG&#x27;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="7-创建和管理表"><a href="#7-创建和管理表" class="headerlink" title="7.创建和管理表"></a>7.创建和管理表</h2><p>学习目标：</p>
<ol>
<li>描述主要的数据库对象</li>
<li>创建表</li>
<li>描述各种数据类型</li>
<li>修改表的定义</li>
<li>删除、重命名和清空表</li>
</ol>
<h3 id="常见的数据库对象"><a href="#常见的数据库对象" class="headerlink" title="常见的数据库对象"></a>常见的数据库对象</h3><table>
<thead>
<tr>
<th align="left">对象</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">表</td>
<td align="center">基本的数据存储集合，由行和列组成</td>
</tr>
<tr>
<td align="left">视图</td>
<td align="center">从表中抽出的逻辑上相关的数据集合</td>
</tr>
<tr>
<td align="left">序列</td>
<td align="center">提供有规律的数值</td>
</tr>
<tr>
<td align="left">索引</td>
<td align="center">提高查询的效率</td>
</tr>
<tr>
<td align="left">同义词</td>
<td align="center">给对象起别名</td>
</tr>
</tbody></table>
<p>Oracle 数据库中的表<br>用户定义的表：</p>
<ol>
<li>用户自己创建并维护的一组表</li>
<li>包含了用户所需的信息</li>
</ol>
<p>SELECT * FROM user_tables | 查看用户创建的表<br>SELECT DISTINCT object_type FROM user_objects | 查看用户定义的各种数据库对象<br>SELECT * FROM user_catalog | 查看用户定义的表，视图，同义词和序列</p>
<p>数据字典：</p>
<ol>
<li>由Oracle Server 自动创建的一组表</li>
<li>包含数据库信息</li>
</ol>
<h3 id="命名规则"><a href="#命名规则" class="headerlink" title="命名规则"></a>命名规则</h3><p>表明和列明：</p>
<ol>
<li>必须以字母开头</li>
<li>必须在1-30个字符之间</li>
<li>必须只能包含A-Z，a-z，0-9，_，$, 和#</li>
<li>必须不能和用户定义的其它对象重名</li>
<li>必须不能是Oracle的保留字</li>
</ol>
<h3 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h3><p>必须具备：</p>
<ol>
<li>CREATE TABLE权限</li>
<li>存储空间</li>
</ol>
<p>必须指定：</p>
<ol>
<li>表名</li>
<li>列明，数据类型，尺寸</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> [schema.]<span class="keyword">table</span></span><br><span class="line">      (<span class="keyword">column</span> datatype [<span class="keyword">DEFAULT</span> expr] [, ...]);</span><br></pre></td></tr></table></figure>

<p>第一种方式：重新创建</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emp1(</span><br><span class="line">   id number(<span class="number">10</span>),</span><br><span class="line">   name VARCHAR2(<span class="number">20</span>),</span><br><span class="line">   SALARY number(<span class="number">10</span>,<span class="number">2</span>),</span><br><span class="line">   hire_date <span class="type">DATE</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>第二种方式：依托于现有表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">TABLE</span> emp2 </span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id id, last_name name, hire_date, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">TABLE</span> emp3</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id id, last_name name, hire_date, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">2</span></span><br></pre></td></tr></table></figure>

<p><strong>数据类型</strong><br>| 数据类型     |                 描述                 |<br>| :———– | :———————————-: |<br>| VARCHAR2     |            可变长字符数据            |<br>| CHAR(size)   |             定长字符数据             |<br>| NUMBER(p, s) |            可变长数值数据            |<br>| DATE         |              日期型数据              |<br>| LONG         |     可变长字符数据，最大可达到2G     |<br>| CLOB         |         字符数据，最大可达4G         |<br>| RAW          |           原始的二进制数据           |<br>| BLOB         |        二进制数据，最大可达4G        |<br>| BFILE        | 存储外部文件的二进制数据，最大可达4G |<br>| ROWID        |                行地址                |</p>
<h3 id="修改表"><a href="#修改表" class="headerlink" title="修改表"></a>修改表</h3><p>使用ALTER TABLE语句可以：</p>
<ol>
<li>追加新的列</li>
<li>修改现有的列</li>
<li>为新追加的列定义默认值</li>
<li>删除一个列</li>
<li>重命名表的一个列名</li>
</ol>
<p><strong>追加新的列</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">table</span></span><br><span class="line"><span class="keyword">ADD</span> (<span class="keyword">column</span> datatype [<span class="keyword">DEFAULT</span> expr] [, <span class="keyword">column</span> datatype]...)</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> emp1</span><br><span class="line"><span class="keyword">ADD</span> (email VARCHAR2(<span class="number">20</span>));</span><br></pre></td></tr></table></figure>

<p><strong>修改现有的列</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> emp1</span><br><span class="line">MODIFY (<span class="keyword">column</span> datatype [<span class="keyword">DEFAULT</span> expr] [, <span class="keyword">column</span> datatype]...)</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> emp1</span><br><span class="line">MODIFY (id NUMBER(<span class="number">15</span>));</span><br></pre></td></tr></table></figure>
<p>对默认值的修改只影响以后表的修改</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">table</span> EMP1</span><br><span class="line">MODIFY (salary NUMBER(<span class="number">20</span>,<span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="number">2000</span>)</span><br></pre></td></tr></table></figure>

<p><strong>删除现有列</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">table</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">COLUMN</span> column_name;</span><br></pre></td></tr></table></figure>

<p><strong>重命名列名</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name </span><br><span class="line">RENAME <span class="keyword">COLUMN</span> old_column_name <span class="keyword">TO</span> new_column_name</span><br></pre></td></tr></table></figure>

<h3 id="删除表"><a href="#删除表" class="headerlink" title="删除表"></a>删除表</h3><ol>
<li>数据和结构都被删除</li>
<li>所有正在运行的相关事务被提交</li>
<li>所有相关索引被删除</li>
<li>DROP TABLE 语句不能回滚</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> emp5;</span><br></pre></td></tr></table></figure>

<h3 id="清空表"><a href="#清空表" class="headerlink" title="清空表"></a>清空表</h3><ol>
<li>TRUNCATE TABLE语句：<ol>
<li>删除表中的所有数据</li>
<li>释放表的存储空间<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> detail_dept;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li>TRUNCATE语句不能回滚</li>
<li>可以使用DELETE 语句删除数据，可以回滚</li>
</ol>
<h3 id="改表名"><a href="#改表名" class="headerlink" title="改表名"></a>改表名</h3><p>执行RENAME语句改变表，视图，序列，或同义词的名称</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RENAME emp2 <span class="keyword">TO</span> employees2;</span><br></pre></td></tr></table></figure>
<p>必须是对象的拥有者</p>
<h2 id="8-数据处理"><a href="#8-数据处理" class="headerlink" title="8.数据处理"></a>8.数据处理</h2><p>学习目标：</p>
<ol>
<li>使用DML语句</li>
<li>向表中插入数据</li>
<li>更新表中数据</li>
<li>从表中删除数据</li>
<li>控制事务</li>
</ol>
<h3 id="数据操纵语言"><a href="#数据操纵语言" class="headerlink" title="数据操纵语言"></a>数据操纵语言</h3><p>DML数据操纵语言可以在下列条件下执行：</p>
<ol>
<li>向表中插入数据</li>
<li>修改现存数据</li>
<li>删除现存数据</li>
</ol>
<p>事务是由完成若干项工作的DML语句组成的。</p>
<h3 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h3><p><strong>使用INSERT语句语法</strong><br>使用INSERT语句向表中插入数据：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">table</span> [(<span class="keyword">column</span> [, column...])]</span><br><span class="line"><span class="keyword">VALUES</span> (value1 [,value2...]);</span><br></pre></td></tr></table></figure>
<p>该语法一次只能向表中插入一条数据。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp1</span><br><span class="line"><span class="keyword">VALUE</span>(<span class="number">1001</span>, <span class="string">&#x27;AA&#x27;</span>, SYSDATE, <span class="number">10000</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp1</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="number">1002</span>, <span class="string">&#x27;BB&#x27;</span>, TO_DATE(<span class="string">&#x27;1998-10-25&#x27;</span>, <span class="string">&#x27;yyyy-mm-dd&#x27;</span>), <span class="number">20000</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp1</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="number">1003</span>, <span class="string">&#x27;CC&#x27;</span>, TO_DATE(<span class="string">&#x27;1999-12-21&#x27;</span>,<span class="string">&#x27;yyyy-mm-dd&#x27;</span>), <span class="keyword">null</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp1 (last_name, employee_id, hire_date)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;DD&#x27;</span>, <span class="number">1004</span>, TO_CHAR(<span class="string">&#x27;1679-12-22&#x27;</span>, <span class="string">&#x27;yyyy-mm-dd&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p><strong>从其它表中拷贝数据</strong></p>
<ol>
<li>在INSERT语句中加入子查询</li>
<li>不必书写VALUES子句</li>
<li>子查询中的值列表应与INSERT子句中的列明对应</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp2 </span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="operator">=</span> <span class="number">90</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> sales_reps(id, name, salary, commission_pot)</span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, salary, commission_pot</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> job_id <span class="keyword">LIKE</span> <span class="string">&#x27;%REP%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>创建脚本</strong></p>
<ol>
<li>在SQL语句中使用&amp;变量指定列值</li>
<li>&amp;变量放在VALUES子句中</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> departments</span><br><span class="line">(department_id, department_name, location_id)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="operator">&amp;</span>department_id, <span class="string">&#x27;&amp;department_name&#x27;</span>, <span class="operator">&amp;</span>location);</span><br></pre></td></tr></table></figure>

<h3 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h3><ol>
<li>使用UPDATE语句更新数据<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UPDATE table_name</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">column</span> <span class="operator">=</span>  value1 [, column2 <span class="operator">=</span> value2, ...]</span><br><span class="line">[<span class="keyword">WHERE</span> <span class="keyword">condition</span>];</span><br></pre></td></tr></table></figure></li>
<li>可以一次更新<strong>多条</strong>数据。</li>
<li>使用WHERE子句指定需要更新的数据。</li>
<li>如果省略WHERE子句，则表中的所有数据都将被更新。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 更新114号员工的工作和工资使其与205号员工相同。</span></span><br><span class="line"></span><br><span class="line">UPDATE employees</span><br><span class="line"><span class="keyword">SET</span> (job_id, salary) <span class="operator">=</span> (</span><br><span class="line">   <span class="keyword">SELECT</span> job_id, salary</span><br><span class="line">   <span class="keyword">FROM</span> employees</span><br><span class="line">   <span class="keyword">WHERE</span> employee_id <span class="operator">=</span> <span class="number">205</span></span><br><span class="line">   ) </span><br><span class="line"><span class="keyword">WHERE</span> employee_id <span class="operator">=</span> <span class="number">114</span>;</span><br></pre></td></tr></table></figure>

<p>注意更新中的数据完整性错误。</p>
<h3 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h3><ol>
<li>使用DELETE语句从表中删除数据<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> table_name</span><br><span class="line">[<span class="keyword">WHERE</span> <span class="keyword">condition</span>];</span><br></pre></td></tr></table></figure></li>
<li>使用WHERE子句删除指定的记录</li>
<li>如果省略WHERE子句，则表中的全部数据将被删除</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 从emp1表中删除dept1部门名称中含有Public字符的部门id</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> emp1</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="keyword">IN</span> (</span><br><span class="line">   <span class="keyword">SELECT</span> department_id</span><br><span class="line">   <span class="keyword">FROM</span> departments</span><br><span class="line">   <span class="keyword">WHERE</span> department_name <span class="keyword">LIKE</span> <span class="string">&#x27;%Public%&#x27;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>注意删除中的数据完整性错误。</p>
<h3 id="数据库事务"><a href="#数据库事务" class="headerlink" title="数据库事务"></a>数据库事务</h3><p>事务：一组逻辑操作单元，使数据从一种状态变换到另一种状态。</p>
<p>数据库事务由以下的部分组成：</p>
<ol>
<li>一个或多个的DML语句</li>
<li>一个DDL语句</li>
<li>一个DCL语句</li>
</ol>
<p>数据库事务：</p>
<ol>
<li>以第一个DML语句的执行作为开始</li>
<li>以下面的其中之一作为结束：<ol>
<li>COMMIT或ROLLBACK语句</li>
<li>DDL语句</li>
<li>用户会话正常结束</li>
<li>系统异常终止</li>
</ol>
</li>
</ol>
<h4 id="回滚到保存点"><a href="#回滚到保存点" class="headerlink" title="回滚到保存点"></a>回滚到保存点</h4><ol>
<li>使用SAVEPOINT语句在当前事务中创建保存点</li>
<li>使用ROLLBACK TO SAVEPOINT语句回滚到创建的保存点</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">UPDATE ...</span><br><span class="line"><span class="keyword">SAVEPOINT</span> update_done;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">ROLLBACK</span> <span class="keyword">to</span> update_done;</span><br></pre></td></tr></table></figure>

<p><strong>提交或回滚前的数据状态</strong></p>
<ol>
<li>改变前的数据状态是可以恢复的</li>
<li>执行DML操作的用户可以通过SELECT语句查询之前的修正</li>
<li>其它用户不能看到当前用户所做的改变，直到当前用户结束事务</li>
<li>DML语句所涉及到的行被锁定，其他用户不能操作</li>
</ol>
<p><strong>提交后的数据状态</strong></p>
<ol>
<li>数据改变已经被保存到数据库中</li>
<li>改变前的数据已经丢失</li>
<li>所有用户可以看到结果</li>
<li>锁被释放，其他用户可以操作涉及到的数据</li>
<li>所有保存点被释放</li>
</ol>
<p><strong>数据回滚后的状态</strong><br>使用ROLLBACK语句可以使数据变化失效：</p>
<ol>
<li>数据改变被取消</li>
<li>修改前的数据状态被恢复</li>
<li>锁被释放</li>
</ol>
<h2 id="9-约束"><a href="#9-约束" class="headerlink" title="9.约束"></a>9.约束</h2><p>学习目标：</p>
<ol>
<li>描述约束</li>
<li>创建和维护约束</li>
</ol>
<p><strong>注意事项</strong></p>
<ol>
<li>如果不指定约束名，Oracle server自动按照SYS_Cn的格式指定约束名</li>
<li>创建和修改约束：<ol>
<li>建表的同时</li>
<li>建表之后</li>
</ol>
</li>
<li>可以在表级或列级定义约束</li>
<li>可以通过数据字典视图查看约束</li>
</ol>
<p><strong>表级约束和列级约束</strong></p>
<ol>
<li>作用范围：<ol>
<li>列级约束只能作用在一个列上</li>
<li>表级约束可以作用在多个列上</li>
</ol>
</li>
<li>定义方式：列约束必须跟在列的定义后面，表约束不与列一起，而是单独定义</li>
<li>非空(NOT NULL)约束只能定义在列上</li>
</ol>
<h3 id="NOT-NULL约束"><a href="#NOT-NULL约束" class="headerlink" title="NOT NULL约束"></a>NOT NULL约束</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emp2(</span><br><span class="line">   id NUMBER(<span class="number">10</span>) <span class="keyword">CONSTRAINT</span> emp2_id_nn <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">   name VARCHAR2(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">   salary NUMBER(<span class="number">10</span>,<span class="number">2</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="UNIQUE约束"><a href="#UNIQUE约束" class="headerlink" title="UNIQUE约束"></a>UNIQUE约束</h3><p>唯一约束，要求列中插入的值是唯一的，可以为NULL。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emp3(</span><br><span class="line">   id NUMBER(<span class="number">10</span>) <span class="keyword">CONSTRAINT</span> emp3_id_uk <span class="keyword">UNIQUE</span>,</span><br><span class="line">   name VARCHAR2(<span class="number">20</span>) <span class="keyword">CONSTRAINT</span> emp3_name_nn <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">   salary NUMBER(<span class="number">10</span>,<span class="number">2</span>),</span><br><span class="line">   email VARCHAR2(<span class="number">20</span>),  </span><br><span class="line"><span class="comment">-- 表级约束</span></span><br><span class="line"><span class="keyword">CONSTRAINT</span> emp3_email_uk <span class="keyword">UNIQUE</span>(email)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="主键约束"><a href="#主键约束" class="headerlink" title="主键约束"></a>主键约束</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emp4(</span><br><span class="line">   id NUMBER(<span class="number">10</span>) <span class="keyword">CONSTRAINT</span> emp4_id_pk <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">   name VARCHAR2(<span class="number">20</span>) <span class="keyword">CONSTRAINT</span> emp4_name_nn <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">   salary NUMBER(<span class="number">10</span>,<span class="number">2</span>),</span><br><span class="line">   email VARCHAR2(<span class="number">20</span>),  </span><br><span class="line"><span class="comment">-- 表级约束</span></span><br><span class="line"><span class="keyword">CONSTRAINT</span> emp4_email_uk <span class="keyword">UNIQUE</span>(email)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emp4(</span><br><span class="line">   id NUMBER(<span class="number">10</span>) ,</span><br><span class="line">   name VARCHAR2(<span class="number">20</span>) <span class="keyword">CONSTRAINT</span> emp4_name_nn <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">   salary NUMBER(<span class="number">10</span>,<span class="number">2</span>),</span><br><span class="line">   email VARCHAR2(<span class="number">20</span>),  </span><br><span class="line"><span class="comment">-- 表级约束</span></span><br><span class="line"><span class="keyword">CONSTRAINT</span> emp4_email_uk <span class="keyword">UNIQUE</span>(email),</span><br><span class="line"><span class="keyword">CONSTRAINT</span> emp4_id_pk <span class="keyword">PRIMARY</span> KEY(id)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>主键的特点：</p>
<ol>
<li>非空</li>
<li>唯一</li>
</ol>
<h3 id="外键约束"><a href="#外键约束" class="headerlink" title="外键约束"></a>外键约束</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emp5(</span><br><span class="line">   id NUMBER(<span class="number">10</span>) ,</span><br><span class="line">   name VARCHAR2(<span class="number">20</span>) <span class="keyword">CONSTRAINT</span> emp5_name_nn <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">   salary NUMBER(<span class="number">10</span>,<span class="number">2</span>),</span><br><span class="line">   email VARCHAR2(<span class="number">20</span>),</span><br><span class="line">   department_id NUMBER(<span class="number">10</span>)  </span><br><span class="line"><span class="comment">-- 表级约束</span></span><br><span class="line"><span class="keyword">CONSTRAINT</span> emp5_email_uk <span class="keyword">UNIQUE</span>(email),</span><br><span class="line"><span class="keyword">CONSTRAINT</span> emp5_id_pk <span class="keyword">PRIMARY</span> KEY(id),</span><br><span class="line"><span class="keyword">CONSTRAINT</span> emp5_dept_id_fk <span class="keyword">FOREIGN</span> KEY(department_id) <span class="keyword">REFERENCES</span> departments(department_id)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>–FOREIGN KEY：在表级指定子表中的列<br>–REFERENCES：标示在父表中的列<br>–ON DELETE CASCADE (级联删除):当父表中的列被删除时，子表中相对应的列也被删除<br>–ON DELETE SET NULL (级联置空)：子表中相应的列置空</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emp5(</span><br><span class="line">   id NUMBER(<span class="number">10</span>) ,</span><br><span class="line">   name VARCHAR2(<span class="number">20</span>) <span class="keyword">CONSTRAINT</span> emp5_name_nn <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">   salary NUMBER(<span class="number">10</span>,<span class="number">2</span>),</span><br><span class="line">   email VARCHAR2(<span class="number">20</span>),</span><br><span class="line">   department_id NUMBER(<span class="number">10</span>)  </span><br><span class="line"><span class="comment">-- 表级约束</span></span><br><span class="line"><span class="keyword">CONSTRAINT</span> emp5_email_uk <span class="keyword">UNIQUE</span>(email),</span><br><span class="line"><span class="keyword">CONSTRAINT</span> emp5_id_pk <span class="keyword">PRIMARY</span> KEY(id),</span><br><span class="line"><span class="keyword">CONSTRAINT</span> emp5_dept_id_fk <span class="keyword">FOREIGN</span> KEY(department_id) <span class="keyword">REFERENCES</span> departments(department_id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE</span><br></pre></td></tr></table></figure>

<h3 id="检查约束"><a href="#检查约束" class="headerlink" title="检查约束"></a>检查约束</h3><p>定义每一行必须满足的条件</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emp5(</span><br><span class="line">   id NUMBER(<span class="number">10</span>) ,</span><br><span class="line">   name VARCHAR2(<span class="number">20</span>) <span class="keyword">CONSTRAINT</span> emp5_name_nn <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">   salary NUMBER(<span class="number">10</span>,<span class="number">2</span>) <span class="keyword">CONSTRAINT</span> emp5_salary <span class="keyword">CHECK</span>(salary <span class="operator">&gt;</span> <span class="number">1500</span>),</span><br><span class="line">   email VARCHAR2(<span class="number">20</span>),</span><br><span class="line">   department_id NUMBER(<span class="number">10</span>)  </span><br><span class="line"><span class="comment">-- 表级约束</span></span><br><span class="line"><span class="keyword">CONSTRAINT</span> emp5_email_uk <span class="keyword">UNIQUE</span>(email),</span><br><span class="line"><span class="keyword">CONSTRAINT</span> emp5_id_pk <span class="keyword">PRIMARY</span> KEY(id),</span><br><span class="line"><span class="keyword">CONSTRAINT</span> emp5_dept_id_fk <span class="keyword">FOREIGN</span> KEY(department_id) <span class="keyword">REFERENCES</span> departments(department_id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE</span><br></pre></td></tr></table></figure>

<h3 id="添加约束的语法"><a href="#添加约束的语法" class="headerlink" title="添加约束的语法"></a>添加约束的语法</h3><p>使用ALTER TABLE语句：</p>
<ol>
<li>添加或删除约束，但是不能修改约束</li>
<li>有效化或无效化约束</li>
<li>添加NOT NULL约束要使用MODIFY语句</li>
</ol>
<h4 id="添加或删除约束"><a href="#添加或删除约束" class="headerlink" title="添加或删除约束"></a>添加或删除约束</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> emp5</span><br><span class="line">MODIFY(salary NUMBER(<span class="number">10</span>,<span class="number">2</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>)</span><br></pre></td></tr></table></figure>

<p><strong>删除约束</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> emp5</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> emp5_name_nn</span><br></pre></td></tr></table></figure>

<p><strong>添加约束</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> emp5</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> emp5_name_uk_unique(name)</span><br></pre></td></tr></table></figure>

<h4 id="无效化约束"><a href="#无效化约束" class="headerlink" title="无效化约束"></a>无效化约束</h4><p>在ALTER TABLE语句中使用DISABLE子句将约束无效化</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> employees</span><br><span class="line">DISABLE <span class="keyword">CONSTRAINT</span> emp_emp_id_pk;</span><br></pre></td></tr></table></figure>

<h4 id="有效化约束"><a href="#有效化约束" class="headerlink" title="有效化约束"></a>有效化约束</h4><p>在ALTER TABLE语句中使用ENABLE子句将约束有效化</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> ABLE employees</span><br><span class="line">ENABLE <span class="keyword">CONSTRAINT</span> emp_emp_id_pk;</span><br></pre></td></tr></table></figure>

<h3 id="查询约束"><a href="#查询约束" class="headerlink" title="查询约束"></a>查询约束</h3><p>查询数据字典视图 USER_CONSTRAINTS</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> constraint_name, constraint_type, search_condition</span><br><span class="line"><span class="keyword">FROM</span> user_constraints</span><br><span class="line"><span class="keyword">WHERE</span> table_name <span class="operator">=</span> <span class="string">&#x27;EMPLOYEES&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="查询定义约束的列"><a href="#查询定义约束的列" class="headerlink" title="查询定义约束的列"></a>查询定义约束的列</h3><p>查询数据字典视图USER_CONS_COLUMNS</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> constraint_name, column_name</span><br><span class="line"><span class="keyword">FROM</span> user_cons_columns</span><br><span class="line"><span class="keyword">WHERE</span> table_name <span class="operator">=</span> <span class="string">&#x27;EMPLOYEES&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="10-视图"><a href="#10-视图" class="headerlink" title="10.视图"></a>10.视图</h2><p>学习目标：</p>
<ol>
<li>描述视图</li>
<li>创建和修改视图的定义，删除视图</li>
<li>从视图中查询数据</li>
<li>通过视图插入，修改和删除数据</li>
<li>使用“Top-N”分析</li>
</ol>
<p><strong>为什么使用视图</strong></p>
<ol>
<li>控制数据访问</li>
<li>简化查询</li>
<li>避免重复访问相同的数据</li>
</ol>
<h3 id="创建视图"><a href="#创建视图" class="headerlink" title="创建视图"></a>创建视图</h3><p>在CREATE VIEW 语句中嵌入子查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> [<span class="keyword">OR</span> REPLACE] [FORCE<span class="operator">|</span>NOFORCE] <span class="keyword">VIEW</span> view_name</span><br><span class="line">[(alias[, alias]...)]</span><br><span class="line"><span class="keyword">AS</span> subquery</span><br><span class="line">[<span class="keyword">WITH</span> <span class="keyword">CHECK</span> OPTION [<span class="keyword">CONSTRAINT</span> <span class="keyword">constraint</span>]]</span><br><span class="line">[<span class="keyword">WITH</span> READ <span class="keyword">ONLY</span> [<span class="keyword">CONSTRAINT</span> <span class="keyword">constraint</span>]];</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> empview</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="operator">=</span> <span class="number">80</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UPDATE empview</span><br><span class="line"><span class="keyword">SET</span> salary <span class="operator">=</span> <span class="number">20000</span></span><br><span class="line"><span class="keyword">WHERE</span> employee_id <span class="operator">=</span> <span class="number">179</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> employee_id <span class="operator">=</span> <span class="number">179</span>;</span><br></pre></td></tr></table></figure>

<p>子查询可以是复杂的SELECT语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> empview2</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id id, last_name name, salary, department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e, departments d</span><br><span class="line"><span class="keyword">WHERE</span> e.department_id <span class="operator">=</span> d.department_id</span><br></pre></td></tr></table></figure>
<h3 id="查询视图"><a href="#查询视图" class="headerlink" title="查询视图"></a>查询视图</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> salvu50;</span><br></pre></td></tr></table></figure>

<h3 id="修改视图"><a href="#修改视图" class="headerlink" title="修改视图"></a>修改视图</h3><p>使用CREATE OR REPLACE VIEW 子句修改视图</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">VIEW</span> empvu80</span><br><span class="line">(id_number, name, sal, department_id)</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id, first_name <span class="operator">||</span> ` `<span class="operator">||</span> last_name, salary, department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="operator">=</span> <span class="number">80</span>; </span><br></pre></td></tr></table></figure>
<p>CREATE VIEW 子句中各列的别名应和子查询中各列相对应</p>
<h3 id="删除视图"><a href="#删除视图" class="headerlink" title="删除视图"></a>删除视图</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> empview3;</span><br></pre></td></tr></table></figure>

<h3 id="屏蔽DML操作"><a href="#屏蔽DML操作" class="headerlink" title="屏蔽DML操作"></a>屏蔽DML操作</h3><ol>
<li>可以使用 WITH READ ONLY 选项屏蔽对视图的DML操作</li>
<li>任何DML操作都会返回一个Oracle server错误</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> empview2</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id id, last_name name, salary, department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e, departments d</span><br><span class="line"><span class="keyword">WHERE</span> e.department_id <span class="operator">=</span> d.department_id</span><br><span class="line"><span class="keyword">WITH</span> READ <span class="keyword">ONLY</span>;</span><br></pre></td></tr></table></figure>

<p>简单视图和复杂视图<br>| 特性     | 简单视图 |   复杂试图 |<br>| :——- | :——: | ———: |<br>| 表的数量 |   一个   | 一个或多个 |<br>| 函数     |   没有   |         有 |<br>| 分组     |   没有   |         有 |<br>| DML操作  |   可以   |   有时可以 |</p>
<p><strong>复杂试图</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">VIEW</span> empview3</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> department_name dept_name, <span class="built_in">AVG</span>(salary) avg_sal</span><br><span class="line"><span class="keyword">FROM</span> employees e, departments d</span><br><span class="line"><span class="keyword">WHERE</span> e.department_id <span class="operator">=</span> d.department_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_name</span><br></pre></td></tr></table></figure>

<p>视图中使用DML的规定</p>
<ol>
<li>可以在简单视图中执行DML操作</li>
<li>当视图定义包含以下元素之一时不能使用DELETE：<ol>
<li>聚合函数</li>
<li>GROUP BY 子句</li>
<li>DISTINCT 关键字</li>
<li>ROWNUM 伪列</li>
</ol>
</li>
<li>当视图定义包含以下元素之一时不能使用UPDATE：<ol>
<li>聚合函数</li>
<li>GROUP BY 子句</li>
<li>DISTINCT 关键字</li>
<li>ROWNUM 伪列</li>
<li>列的定义为表达式</li>
</ol>
</li>
<li>当视图定义包含以下元素之一时不能使用INSERT：<ol>
<li>聚合函数</li>
<li>GROUP BY 子句</li>
<li>DISTINCT 关键字</li>
<li>ROWNUM 伪劣</li>
<li>列的定义为表达式</li>
<li>表中非空的列在视图定义中未包括</li>
</ol>
</li>
</ol>
<h3 id="Top-N分析"><a href="#Top-N分析" class="headerlink" title="Top-N分析"></a>Top-N分析</h3><p>Top-N分析查询一个列中最大或最小的N个值：</p>
<ol>
<li>销售量最高的十种产品是什么</li>
<li>销售量最差的十种产品是什么</li>
</ol>
<p>最大和最小的值的集合是Top-N分析所关心的</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> rownum, employee_id, last_name, salary</span><br><span class="line"><span class="keyword">FROM</span> (<span class="keyword">SELECT</span> employee_id, last_name, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">WHERE</span> rownum <span class="operator">&lt;=</span> <span class="number">10</span>;</span><br></pre></td></tr></table></figure>
<p>注意：对ROWNUM 只能使用 &lt; 或&lt;= ；而用=, &gt;, &gt;= 都将不能返回任何数据。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> rn, employee_id, last_name, salary</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">   <span class="keyword">SELECT</span> rownum rn, employee_id, last_name, salary</span><br><span class="line">   <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> employee_id, last_name, salary</span><br><span class="line">         <span class="keyword">FROM</span> employees</span><br><span class="line">         <span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span></span><br><span class="line">   )</span><br><span class="line">)</span><br><span class="line"><span class="keyword">WHERE</span> rn <span class="operator">&gt;</span> <span class="number">40</span> <span class="keyword">AND</span> rn <span class="operator">&lt;=</span> <span class="number">50</span></span><br></pre></td></tr></table></figure>

<h2 id="11-其它数据库对象"><a href="#11-其它数据库对象" class="headerlink" title="11.其它数据库对象"></a>11.其它数据库对象</h2><h3 id="序列"><a href="#序列" class="headerlink" title="序列"></a>序列</h3><h4 id="什么是序列"><a href="#什么是序列" class="headerlink" title="什么是序列"></a>什么是序列</h4><p>序列：可提供多个用户用来产生唯一数值的数据库对象</p>
<ol>
<li>自动提供唯一的数值</li>
<li>共享对象</li>
<li>主要用于提供主键值</li>
<li>将序列值装入内存可以提高访问效率</li>
</ol>
<h4 id="创建序列"><a href="#创建序列" class="headerlink" title="创建序列"></a>创建序列</h4><p>CREATE SEQUENCE语句<br>定义序列：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> SEQUENCE sequence_name</span><br><span class="line">[INCREMENT <span class="keyword">BY</span> n] <span class="comment">-- 每次增长的数值</span></span><br><span class="line">[<span class="keyword">START</span> <span class="keyword">WITH</span> n] <span class="comment">-- 从哪个值开始</span></span><br><span class="line">[&#123;MAXVALUE n | NOMAXVALUE&#125;]</span><br><span class="line">[&#123;MINVALUE n | NOMINVALUE&#125;]</span><br><span class="line">[&#123;CYCLE | NOCYCLE&#125;] -- 是否需要循环</span><br><span class="line">[&#123;CACHE n | NOCACHE&#125;]; --是否缓存登录</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> SEQUENCE empseq</span><br><span class="line">INCREMENT <span class="keyword">BY</span> <span class="number">10</span></span><br><span class="line"><span class="keyword">START</span> <span class="keyword">WITH</span> <span class="number">10</span></span><br><span class="line">MAXVALUE <span class="number">100</span></span><br><span class="line"><span class="keyword">CYCLE</span></span><br><span class="line">NOCACHE</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> empseq.currval <span class="keyword">FROM</span> dual;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> empseq.nextval <span class="keyword">FROM</span> dual;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emp01</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id, lst_name, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- NEXTVAL 返回序列中下一个有效的值，任何用户都可以引用</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp01</span><br><span class="line"><span class="keyword">VALUES</span>(empseq.nextval, <span class="string">&#x27;AA&#x27;</span>, <span class="number">3400</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- CURRVAL 中存放序列的当前值</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp01</span><br><span class="line"><span class="keyword">VALUES</span>(empseq.nextval, <span class="string">&#x27;BB&#x27;</span>, <span class="number">3412</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- NEXTVAL应在CURRVAL之前指定，否则会报CURRVAL尚未在此会话中定义的错误</span></span><br></pre></td></tr></table></figure>

<h4 id="修改序列"><a href="#修改序列" class="headerlink" title="修改序列"></a>修改序列</h4><p>修改序列的增量，最大值，最小值，循环选型，或是否装入内存</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> SEQUENCE empseq</span><br><span class="line">INCREMENT <span class="keyword">BY</span> <span class="number">1</span></span><br><span class="line">NOCYCLE</span><br></pre></td></tr></table></figure>
<p><strong>修改序列的注意事项</strong></p>
<ol>
<li>必须是序列的拥有者或对序列有ALTER权限</li>
<li>只有将来的序列值会被改变</li>
<li>改变序列的初始值只能通过删除序列之后重建序列的方法实现</li>
</ol>
<h4 id="使用序列"><a href="#使用序列" class="headerlink" title="使用序列"></a>使用序列</h4><ol>
<li>将序列值装入内存可提高访问效率</li>
<li>序列在下列情况下出现裂缝：<ol>
<li>回滚</li>
<li>系统异常</li>
<li>多个表同时使用同一序列</li>
</ol>
</li>
<li>如果不将序列的值装入内存(NOCACHE),可使用表USER_SEQUENCES查看序列当前的有效值</li>
</ol>
<h4 id="查询序列"><a href="#查询序列" class="headerlink" title="查询序列"></a>查询序列</h4><p>查询数据字典视图 USER_SEQUENCES 获取序列定义信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> sequence_name, min_value, max_value, increment_by, last_number</span><br><span class="line"><span class="keyword">FROM</span> user_sequences;</span><br></pre></td></tr></table></figure>
<p>如果指定NOCACHE选项，则列LAST_NUMBER显示序列中下一个有效的值</p>
<h4 id="删除序列"><a href="#删除序列" class="headerlink" title="删除序列"></a>删除序列</h4><p>使用DROP SEQUENCE语句删除序列<br>删除之后，序列不能再次被引用</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> SEQUENCE dept_deptid_seq;</span><br></pre></td></tr></table></figure>

<h3 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h3><p>索引：</p>
<ol>
<li>一种独立于表的模式对象，可以存储在与表不同的磁盘或表空间中</li>
<li>索引被删除或损坏，不会对表产生影响，其影响的只是查询的速度</li>
<li>索引一旦建立，Oracle管理系统会对其进行自动维护，而且Oracle管理系统决定何时使用索引。用户不用在查询语句中指定使用哪个索引</li>
<li>在删除一个表时，所有基于该表的索引会自动被删除</li>
<li>通过指针加速Oracle服务区的查询速度</li>
<li>通过快速定位数据的方法，减少磁盘I/O</li>
</ol>
<h4 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h4><ol>
<li>自动创建：在定义PRIMARY KEY 或者 UNIQUE约束后系统自动在相应的列上创建唯一索引</li>
<li>手动创建：用户可以在其它列上创建非唯一的索引，以加速查询</li>
</ol>
<p>在一个或多个列上创建索引</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX index_name</span><br><span class="line"><span class="keyword">ON</span> table_name(<span class="keyword">column</span> [,<span class="keyword">column</span>]...);</span><br></pre></td></tr></table></figure>

<p>在表EMPLOYEES的列LAST_NAME上创建索引</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATEA INDEX emp_last_name</span><br><span class="line"><span class="keyword">ON</span> employees(last_name);</span><br></pre></td></tr></table></figure>

<p><strong>什么时候创建索引</strong><br>以下情况可以创建索引：</p>
<ol>
<li>列中数据值分布范围很广</li>
<li>列经常在WHERE子句或连接条件中出现</li>
<li>表经常被访问而且数据量很大，访问的数据大概占数据总量的2%~4%</li>
</ol>
<p><strong>什么时候不要创建索引</strong><br>下列情况不要创建索引：</p>
<ol>
<li>表很小</li>
<li>列不经常作为连接条件或出现在WHERE子句中</li>
<li>查询的数据大于2%~4%</li>
<li>表经常更新</li>
</ol>
<h4 id="查询索引"><a href="#查询索引" class="headerlink" title="查询索引"></a>查询索引</h4><p>可以使用数据字典视图USER_INDEXES 和USER_IND_COLUMNS查看索引的信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ic.index_name, ic.column_name, ic.column_position_col_pos, ix.uniqueness</span><br><span class="line"><span class="keyword">FROM</span> user_indexes ix, user_ind_columns ic</span><br><span class="line"><span class="keyword">WHERE</span> ic.index_name <span class="operator">=</span> ix.index_name</span><br><span class="line"><span class="keyword">AND</span> ic.table_name <span class="operator">=</span> <span class="string">&#x27;EMPLOYEES&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h4><ol>
<li>使用DROP INDEX删除索引<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> INDEX index_name;</span><br></pre></td></tr></table></figure></li>
<li>删除索引UPPER_LAST_NAME_IDX<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> INDEX upper_last_name_idx;</span><br></pre></td></tr></table></figure></li>
<li>只有索引的拥有者或拥有DROP ANY  INDEX 权限的用户才可以删除索引</li>
<li>删除操作是不可回滚的</li>
</ol>
<h3 id="同义词-SYNONYM"><a href="#同义词-SYNONYM" class="headerlink" title="同义词-SYNONYM"></a>同义词-SYNONYM</h3><p>使用同义词访问相同的对象：</p>
<ol>
<li>方便访问其它用户的对象</li>
<li>缩短对象名字的长度</li>
</ol>
<h4 id="创建和删除同义词"><a href="#创建和删除同义词" class="headerlink" title="创建和删除同义词"></a>创建和删除同义词</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> [PUBLIC] SYNONYM synonym_name</span><br><span class="line"><span class="keyword">FOR</span> object_name;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> SYNONYM e <span class="keyword">FOR</span> employees;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> e;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> SYNONYM synonym_name;</span><br></pre></td></tr></table></figure>

<h2 id="12-控制用户权限"><a href="#12-控制用户权限" class="headerlink" title="12.控制用户权限"></a>12.控制用户权限</h2><p>目标：</p>
<ol>
<li>创建用户</li>
<li>创建角色</li>
<li>使用GRANT和REVOKE语句赋予和回收权限</li>
<li>创建数据库联接</li>
</ol>
<h3 id="权限"><a href="#权限" class="headerlink" title="权限"></a>权限</h3><ol>
<li>数据库安全性<ol>
<li>系统安全性</li>
<li>数据安全性</li>
</ol>
</li>
<li>系统权限：对于数据库的权限</li>
<li>对象权限：操作数据库对象的权限</li>
</ol>
<p><strong>系统权限</strong></p>
<ol>
<li>超过一百多种有效的权限</li>
<li>数据库管理员具有高级权限以完成管理任务：<ol>
<li>创建新用户</li>
<li>删除用户</li>
<li>删除表</li>
<li>备份表</li>
</ol>
</li>
</ol>
<h4 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h4><p>DBA使用CREATE USER语句创建用户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> user_name</span><br><span class="line">IDENTIFIED <span class="keyword">BY</span> pass_word;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> wk01</span><br><span class="line">IDENTIFIED <span class="keyword">BY</span> wkwk;</span><br></pre></td></tr></table></figure>

<h4 id="用户的系统权限"><a href="#用户的系统权限" class="headerlink" title="用户的系统权限"></a>用户的系统权限</h4><ol>
<li>用户创建之后，DBA会赋予用户一些系统权限<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> privilege [,privilege...]</span><br><span class="line"><span class="keyword">TO</span> <span class="keyword">user</span> [, <span class="keyword">user</span><span class="operator">|</span> role, PUBLIC...];</span><br></pre></td></tr></table></figure></li>
<li>以应用程序开发者为例，一般具有下列系统权限：<ol>
<li>CREATE SESSION (创建会话)</li>
<li>CREATE TABLE (创建表)</li>
<li>CREATE SEQUENCE (创建序列)</li>
<li>CREATE VIEW (创建视图)</li>
<li>CREATE PROCEDURE (创建过程)</li>
</ol>
</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">CREATE</span> SESSION</span><br><span class="line"><span class="keyword">TO</span> wk01;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span></span><br><span class="line"><span class="keyword">to</span> WK01;</span><br></pre></td></tr></table></figure>

<h4 id="创建用户表空间"><a href="#创建用户表空间" class="headerlink" title="创建用户表空间"></a>创建用户表空间</h4><p>用户拥有CREATE TABLE权限之外，还需要分配相应的表空间才可以开辟存储空间用于创建表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> wk01 QUOTA UNLIMITED</span><br><span class="line"><span class="keyword">ON</span> users;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> wk01 QUOTA <span class="number">5</span>M</span><br><span class="line"><span class="keyword">ON</span> users;</span><br></pre></td></tr></table></figure>

<p><strong>修改密码</strong><br>DBA可以创建用户和修改密码<br>用户本可以使用ALTER USER语句修改密码</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> wk01</span><br><span class="line">IDENTIFIED <span class="keyword">BY</span> wkok;</span><br></pre></td></tr></table></figure>

<h4 id="创建角色并赋予权限"><a href="#创建角色并赋予权限" class="headerlink" title="创建角色并赋予权限"></a>创建角色并赋予权限</h4><p><strong>创建角色</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> ROLE manager;</span><br></pre></td></tr></table></figure>

<p><strong>为角色赋予权限</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">CREATE</span> SESSION, <span class="keyword">TABLE</span>, <span class="keyword">CREATE</span> <span class="keyword">VIEW</span></span><br><span class="line"><span class="keyword">TO</span> manager;</span><br></pre></td></tr></table></figure>

<p><strong>将角色赋予用户</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> manager <span class="keyword">TO</span> DEHAAN, KOCHHAR;</span><br></pre></td></tr></table></figure>

<h3 id="对象权限"><a href="#对象权限" class="headerlink" title="对象权限"></a>对象权限</h3><ol>
<li>不同的对象具有不同的对象权限</li>
<li>对象的拥有者拥有所有权限</li>
<li>对象的拥有者可以向外分配权限</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> object_priv [columns]</span><br><span class="line"><span class="keyword">ON</span> object</span><br><span class="line"><span class="keyword">TO</span> [<span class="keyword">user</span><span class="operator">|</span>role<span class="operator">|</span>PUBLIC]</span><br><span class="line">[<span class="keyword">WITH</span> <span class="keyword">GRANT</span> OPTION];</span><br></pre></td></tr></table></figure>

<p><strong>分配对象权限</strong><br>分配表EMPLOYEES的查询权限</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span></span><br><span class="line"><span class="keyword">ON</span> employees</span><br><span class="line"><span class="keyword">TO</span> sue, rich;</span><br></pre></td></tr></table></figure>
<p>分配表中各个列的更新权限</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> UPDATE</span><br><span class="line"><span class="keyword">NO</span> scoot.departments</span><br><span class="line"><span class="keyword">TO</span> wk01;</span><br></pre></td></tr></table></figure>

<p>WITH GRANT OPTION 使用户同样具有分配权限的权利</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>, <span class="keyword">INSERT</span></span><br><span class="line"><span class="keyword">ON</span> departments</span><br><span class="line"><span class="keyword">TO</span> scott</span><br><span class="line"><span class="keyword">WITH</span> <span class="keyword">GRANT</span> OPTION;</span><br></pre></td></tr></table></figure>
<p>向数据库中所有用户分配权限</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span></span><br><span class="line"><span class="keyword">ON</span> alice.departments</span><br><span class="line"><span class="keyword">TO</span> PUBLIC;</span><br></pre></td></tr></table></figure>

<p>收回对象权限</p>
<ol>
<li>使用REVOKE语句收回权限</li>
<li>使用WITH GRANT OPTION 子句所分配的权限同样被收回<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">REVOKE &#123;privilege [, privilege...]|ALL&#125;</span><br><span class="line"><span class="keyword">ON</span> object</span><br><span class="line">FROM &#123;user[, user...] |role|PUBLIC&#125;</span><br><span class="line">[CASCADE CONSTRAINTS];</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">SELECT</span></span><br><span class="line"><span class="keyword">ON</span> employees</span><br><span class="line"><span class="keyword">FROM</span> wk01;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="13-集合运算符"><a href="#13-集合运算符" class="headerlink" title="13.集合运算符"></a>13.集合运算符</h2><p>学习目标：</p>
<ol>
<li>描述集合操作符</li>
<li>将多个查询用集合操作符连接组成一个新的查询<ol>
<li>UNION/UNION ALL</li>
<li>INTERSECT</li>
<li>MINUS</li>
</ol>
</li>
<li>排序ORDER BY</li>
</ol>
<h3 id="UNION-操作符"><a href="#UNION-操作符" class="headerlink" title="UNION 操作符"></a>UNION 操作符</h3><p>UNION操作符返回两个查询的结果集的并集</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> employee01</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="keyword">IN</span>(<span class="number">70</span>, <span class="number">80</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> employee02</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="keyword">IN</span>(<span class="number">80</span>, <span class="number">90</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, department_id</span><br><span class="line"><span class="keyword">FROM</span> employees01</span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id, department_id</span><br><span class="line"><span class="keyword">FROM</span> employees02</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, department_id</span><br><span class="line"><span class="keyword">FROM</span> employees01</span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id, department_id</span><br><span class="line"><span class="keyword">FROM</span> employees02</span><br></pre></td></tr></table></figure>

<h3 id="INTERSECT-操作符"><a href="#INTERSECT-操作符" class="headerlink" title="INTERSECT 操作符"></a>INTERSECT 操作符</h3><p>INTERSECT操作符返回两个结果集的交集</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, department_id</span><br><span class="line"><span class="keyword">FROM</span> employees01</span><br><span class="line"><span class="keyword">INTERSECT</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id, department_id</span><br><span class="line"><span class="keyword">FROM</span> employees02</span><br></pre></td></tr></table></figure>

<h3 id="MINUS操作符"><a href="#MINUS操作符" class="headerlink" title="MINUS操作符"></a>MINUS操作符</h3><p>MINUS操作符返回两个结果集的差集</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, department_id</span><br><span class="line"><span class="keyword">FROM</span> employees01</span><br><span class="line">MINUS</span><br><span class="line"><span class="keyword">SELECT</span> employee_id, department_id</span><br><span class="line"><span class="keyword">FROM</span> employees02</span><br></pre></td></tr></table></figure>

<p>使用集合操作符注意事项</p>
<ol>
<li>在SELECT列表中的列名和表达式在数量和数据类型上要相对应</li>
<li>括号可以改变执行的顺序</li>
<li>ORDER BY 子句：<ol>
<li>只能在语句的最后出现</li>
<li>可以使用第一个查询中的列名，别名或相对位置</li>
</ol>
</li>
<li>除UNION ALL之外，系统会自动将重复的记录删除</li>
<li>系统将第一个查询的列明显示在输出中</li>
<li>除UNION ALL之外，系统自动按照第一个查询中的第一个列的升序排列</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, department_id, TO_CHAR(<span class="keyword">NULL</span>)</span><br><span class="line"><span class="keyword">FROM</span> employees01</span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> TO_NUMBER(<span class="keyword">NULL</span>), department_id, department_name</span><br><span class="line"><span class="keyword">FROM</span> employees02</span><br></pre></td></tr></table></figure>

<p><strong>使用相对位置排序举例</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;study at&#x27;</span>,<span class="number">2</span></span><br><span class="line"><span class="keyword">FROM</span> dual</span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;I WANT TO&#x27;</span>,<span class="number">1</span></span><br><span class="line"><span class="keyword">FROM</span> dual</span><br><span class="line"><span class="keyword">UNION</span> <span class="string">&#x27;aaa&#x27;</span>,<span class="number">3</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">2</span> <span class="keyword">ASC</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COLUMN</span> a_dummy NOPRINT;</span><br></pre></td></tr></table></figure>

<h2 id="14-高级子查询"><a href="#14-高级子查询" class="headerlink" title="14.高级子查询"></a>14.高级子查询</h2><p>学习目标：</p>
<ol>
<li>书写多列子查询</li>
<li>在FROM子句中使用子查询</li>
<li>在SQL中使用单列子查询</li>
<li>书写相关子查询</li>
<li>使用EXISTS和NOT EXISTS操作符</li>
<li>使用子查询更新和删除数据</li>
<li>使用WITH子句</li>
</ol>
<h3 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h3><p>子查询是嵌套在SQL语句中的另一个SELECT语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ...</span><br><span class="line"><span class="keyword">FROM</span> ...</span><br><span class="line"><span class="keyword">WHERE</span> ... (</span><br><span class="line">   SELECT...</span><br><span class="line">   FROM...</span><br><span class="line">   WHERE...</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ol>
<li>子查询在主查询执行之前执行</li>
<li>主查询使用子查询的结果</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询last_name为Chen的manager的信息</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> employee_id <span class="operator">=</span> (</span><br><span class="line">   <span class="keyword">SELECT</span> manager_id</span><br><span class="line">   <span class="keyword">FROM</span> employees</span><br><span class="line">   <span class="keyword">WHERE</span> last_name <span class="operator">=</span> <span class="string">&#x27;Chen&#x27;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="多列子查询"><a href="#多列子查询" class="headerlink" title="多列子查询"></a>多列子查询</h3><p>主查询与子查询返回的多个列进行比较</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询与147号或174号员工的manager_id和department_id相同的其它员工的employee_id，manager_id，department_id</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> employee_id, manager_id, department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> (manager_id, department_id) <span class="keyword">IN</span> (</span><br><span class="line">   <span class="keyword">SELECT</span> manager_id, department_id</span><br><span class="line">   <span class="keyword">FROM</span> employees</span><br><span class="line">   <span class="keyword">WHERE</span> employee_id <span class="keyword">IN</span> (<span class="number">147</span>, <span class="number">174</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><strong>列比较</strong><br>多列子查询中的比较分为两种：</p>
<ol>
<li>成对比较</li>
<li>不成对比较</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 返回比本部门平均工资高的员工的last_name, department_id,salary及平均工资</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name, department_id, salary, (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">FROM</span> employees e3 <span class="keyword">WHERE</span> e1.department_id <span class="operator">=</span> e3.department_id <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id)</span><br><span class="line"><span class="keyword">FROM</span> employees e1</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> (</span><br><span class="line">   <span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary)</span><br><span class="line">   <span class="keyword">FROM</span> employees e2</span><br><span class="line">   <span class="keyword">WHERE</span> e1.department_id <span class="operator">=</span> e2.department_id</span><br><span class="line">   <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 返回比本部门平均工资高的员工的last_name, department_id,salary及平均工资</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name, e1.department_id, salary, e2.avg_sal</span><br><span class="line"><span class="keyword">FROM</span> employees e1, (</span><br><span class="line">   <span class="keyword">SELECT</span> department_id, <span class="built_in">AVG</span>(salary) avg_sal</span><br><span class="line">   <span class="keyword">FROM</span> employees</span><br><span class="line">   <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">) e2</span><br><span class="line"><span class="keyword">WHERE</span> e1.department_id <span class="operator">=</span> e2.department_id <span class="keyword">AND</span> e1.salary <span class="operator">&gt;</span> e2.avg_sal</span><br></pre></td></tr></table></figure>

<h3 id="单列子查询表达式"><a href="#单列子查询表达式" class="headerlink" title="单列子查询表达式"></a>单列子查询表达式</h3><ol>
<li>单列子查询表达式是在一行中只返回一列的子查询</li>
<li>Oracle8i只在下列情况下可以使用，例如：<ol>
<li>SELECT语句(FROM和WHERE子句)</li>
<li>INSERT语句中的VALUES列表中</li>
</ol>
</li>
<li>Oracle9i中单列子查询表达式可在下列情况下使用：<ol>
<li>DECODE和CASE</li>
<li>SELECT中除GROUP BY子句以外的所有子句中</li>
</ol>
</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 显示员工的employee_id，last_name和location，其中，若员工department_id与location_id为1800的department_id相同，则location为&#x27;Canada&#x27;，其余则为&#x27;USA&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, </span><br><span class="line">(<span class="keyword">CASE</span> department_id <span class="keyword">WHEN</span> (<span class="keyword">SELECT</span> department_id <span class="keyword">FROM</span> departments <span class="keyword">WHERE</span> location_id <span class="operator">=</span> <span class="number">1800</span>) <span class="keyword">THEN</span> <span class="string">&#x27;Canada&#x27;</span> <span class="keyword">ELSE</span> <span class="string">&#x27;USA&#x27;</span> <span class="keyword">END</span>) location</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br></pre></td></tr></table></figure>

<p>在ORDER BY子句中使用单列子查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询员工的employee_id, last_name,要求按照员工的department_name排序</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> (<span class="keyword">SELECT</span> department_name</span><br><span class="line">          <span class="keyword">FROM</span> departments d</span><br><span class="line">          <span class="keyword">WHERE</span> e.department_id <span class="operator">=</span> d.department_id</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="相关子查询"><a href="#相关子查询" class="headerlink" title="相关子查询"></a>相关子查询</h3><p>相关子查询按照一行接一行的顺序执行，主查询的每一行都执行一次子查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1, column2,...</span><br><span class="line"><span class="keyword">FROM</span> table1 <span class="keyword">OUTER</span></span><br><span class="line"><span class="keyword">WHERE</span> column1 operator</span><br><span class="line">      (<span class="keyword">SELECT</span> colum1, column2</span><br><span class="line">      <span class="keyword">FROM</span> table2</span><br><span class="line">      <span class="keyword">WHERE</span> expr1 <span class="operator">=</span> auter.expr2</span><br><span class="line">      );</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询员工中工资大于本部门平均工资的员工的last_name,salary和其department_id</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> last_name, salary, department_id</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> (</span><br><span class="line">   <span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary)</span><br><span class="line">   <span class="keyword">FROM</span> employees</span><br><span class="line">   <span class="keyword">WHERE</span> department_id  <span class="operator">=</span> e.department_id</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 若employees表中employee_id与job_history表中employee_id相同的数目不小于2，输出这些相同id的员工的employee_id, last_name和其job_id</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> e.employee_id, e.last_name, job_id</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">WHERE</span> <span class="number">2</span> <span class="operator">&lt;=</span> (</span><br><span class="line">   <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>)</span><br><span class="line">   <span class="keyword">FROM</span> job_history</span><br><span class="line">   <span class="keyword">WHERE</span> employee_id <span class="operator">=</span> e.employee_id</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="EXISTS操作符"><a href="#EXISTS操作符" class="headerlink" title="EXISTS操作符"></a>EXISTS操作符</h3><ol>
<li>EXISTS操作符检查在子查询中是否存在满足条件的行</li>
<li>如果在子查询中存在满足条件的行：<ol>
<li>不在子查询中继续查找</li>
<li>条件返回TRUE</li>
</ol>
</li>
<li>如果在子查询中不存在满足条件的行<ol>
<li>条件返回FALSE</li>
<li>继续在子查询中查找</li>
</ol>
</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询公司管理者的employee_id, last_name, job_id, department_id</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, job_id, department_id</span><br><span class="line"><span class="keyword">FROM</span> employees e1</span><br><span class="line"><span class="keyword">WHERE</span> e1.employee_id <span class="operator">=</span> (</span><br><span class="line">   <span class="keyword">SELECT</span> manager_id</span><br><span class="line">   <span class="keyword">FROM</span> employees e2</span><br><span class="line">   <span class="keyword">WHERE</span> e1.employee_id <span class="operator">=</span> e2.manager_id</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> employee_id, last_name, job_id, department_id</span><br><span class="line"><span class="keyword">FROM</span> employees e1, employees e2</span><br><span class="line"><span class="keyword">WHERE</span> e1.employee_id <span class="operator">=</span> e2.manager_id</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询公司管理者的employee_id, last_name, job_id, department_id</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, job_id, department_id</span><br><span class="line"><span class="keyword">FROM</span> employees e1</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">EXISTS</span>(</span><br><span class="line">   <span class="keyword">SELECT</span> <span class="string">&#x27;A&#x27;</span></span><br><span class="line">   <span class="keyword">FROM</span> employees e2</span><br><span class="line">   <span class="keyword">WHERE</span> e1.employee_id <span class="operator">=</span> e2.manager_id</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><strong>NOT EXISTS操作符</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询departments表中，不存在employees表中的部门的department_id和department_name</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> department_id, department_name</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">   <span class="keyword">SELECT</span> <span class="string">&#x27;X&#x27;</span></span><br><span class="line">   <span class="keyword">FROM</span> employees</span><br><span class="line">   <span class="keyword">WHERE</span> department_id <span class="operator">=</span> d.department_id</span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="相关更新"><a href="#相关更新" class="headerlink" title="相关更新"></a>相关更新</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">UPDATE table1 alias1</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">column</span> <span class="operator">=</span> (</span><br><span class="line">   <span class="keyword">SELECT</span> expression</span><br><span class="line">   <span class="keyword">FROM</span> table2 alias2</span><br><span class="line">   <span class="keyword">WHERE</span> alias1.column <span class="operator">=</span> alias2.column</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>使用相关子查询依据一个表中的数据更新另一个表的数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emp01</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> emp01</span><br><span class="line"><span class="keyword">ADD</span> (department_name VARCHAR2(<span class="number">20</span>))</span><br><span class="line"></span><br><span class="line">UPDATE emp01 e</span><br><span class="line"><span class="keyword">SET</span> department_name <span class="operator">=</span> (</span><br><span class="line">   <span class="keyword">SELECT</span> department_name</span><br><span class="line">   <span class="keyword">FROM</span> departments</span><br><span class="line">   <span class="keyword">WHERE</span> department_id <span class="operator">=</span> e.department_id</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="相关删除"><a href="#相关删除" class="headerlink" title="相关删除"></a>相关删除</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> table1 alias1</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">column</span> operator</span><br><span class="line">         (<span class="keyword">SELECT</span> expression</span><br><span class="line">         <span class="keyword">FROM</span> table2 alias2</span><br><span class="line">         <span class="keyword">WHERE</span> alias1.column <span class="operator">=</span> alias2.column</span><br><span class="line">         );</span><br></pre></td></tr></table></figure>
<p>使用相关子查询依据一个表中的数据删除另一个表的数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 删除表employees中，其与emp_history表皆有的数据</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> employees E</span><br><span class="line"><span class="keyword">WHERE</span> employee_id <span class="operator">=</span> (</span><br><span class="line">   <span class="keyword">SELECT</span> employee_id</span><br><span class="line">   <span class="keyword">FROM</span> emp_history</span><br><span class="line">   <span class="keyword">WHERE</span> employee_id <span class="operator">=</span> E.employee_id</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="WITH子句"><a href="#WITH子句" class="headerlink" title="WITH子句"></a>WITH子句</h3><ol>
<li>使用WITH子句，可以避免在SELECT语句中重复书写相同的语句块</li>
<li>WITH子句将该子句中的语句块执行一次并存储到用户的临时表空间中</li>
<li>使用WITH子句可以提高查询效率</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询公司中工资比Abel高的员工的信息</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WITH</span> Abel_sal <span class="keyword">AS</span> (</span><br><span class="line">   <span class="keyword">SELECT</span> salary</span><br><span class="line">   <span class="keyword">FROM</span> employees</span><br><span class="line">   <span class="keyword">WHERE</span> last_name <span class="operator">=</span> <span class="string">&#x27;Abel&#x27;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> employee_id, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> (</span><br><span class="line">   <span class="keyword">SELECT</span> salary</span><br><span class="line">   <span class="keyword">FROM</span> Abel_sal</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询公司中各部门的总工资大于公司中各部门的平均总工资的部门信息</span></span><br><span class="line"><span class="keyword">WITH</span> dept_sumsal <span class="keyword">AS</span> (</span><br><span class="line"><span class="keyword">SELECT</span> department_name, <span class="built_in">SUM</span>(salary) sum_sal</span><br><span class="line"><span class="keyword">FROM</span> employees e, departments d</span><br><span class="line"><span class="keyword">WHERE</span> e.department_id <span class="operator">=</span> d.department_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_name</span><br><span class="line">),</span><br><span class="line">dept_avgsal <span class="keyword">AS</span> (</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(sum_sal)<span class="operator">/</span><span class="built_in">COUNT</span>(<span class="operator">*</span>) avg_sum_sal</span><br><span class="line"><span class="keyword">FROM</span> dept_sumsal</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> dept_sumsal</span><br><span class="line"><span class="keyword">WHERE</span> sum_sal <span class="operator">&gt;</span> (</span><br><span class="line">   <span class="keyword">SELECT</span> avg_sum_sal</span><br><span class="line">   <span class="keyword">FROM</span> dept_avgsal</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="PL-SQL程序设计"><a href="#PL-SQL程序设计" class="headerlink" title="PL/SQL程序设计"></a>PL/SQL程序设计</h2><p>PL/SQL是一种高级数据库程序设计语言，该语言专门用于在各种环境下对Oracle数据库进行访问。由于该语言集成于数据库服务器中，所以PL/SQL代码可以对数据库进行快速高效的处理。除此之外，可以在Oracle数据库的某些客户端工具中，使用PL/SQL语言也是该语言的一个特点。</p>
<h3 id="SQL与PL-SQL"><a href="#SQL与PL-SQL" class="headerlink" title="SQL与PL/SQL"></a>SQL与PL/SQL</h3><h4 id="什么是PL-SQL"><a href="#什么是PL-SQL" class="headerlink" title="什么是PL/SQL"></a>什么是PL/SQL</h4><p>PL/SQL是Procedure Language &amp; Structured Query Language的缩写。Oracle的SQL是支持ANSI和ISO92标准的产品。PL/SQL是对SQL语言存储过程语言的扩展。从Oracle6以后，Oracle的RDBMS附带PL/SQL。它现在已成为一种过程处理语言，简称PL/SQL。目前的PL/SQL包括两部分，一部分是数据库引擎部分；另一部分是可嵌入到许多产品工具中的独立引擎。可以将这两部分称为：数据库PL/SQL和工具PL/SQL。两者的编程非常相似。都具有编程结构、语法和逻辑机制。工具PL/SQL另外还增加了用于支持工具的语法，如：在窗体上设置按钮等。</p>
<h4 id="PL-SQL可用的SQL语言"><a href="#PL-SQL可用的SQL语言" class="headerlink" title="PL/SQL可用的SQL语言"></a>PL/SQL可用的SQL语言</h4><p>PL/SQL是Oracle系统的核心语言，现在Oracle的许多部件是由PL/SQL写成。在PL/SQL中可以使用的SQL语言有：INSERT,UPDATE,DELETE,SELECT…INTO,COMMIT,ROLLBACK,SAVEPOINT。（在PL/SQL中只能用SQL语句中的DML部分，不能用DDL部分，如果要在PL/SQL中使用DDL的话，只能以动态的方式来使用）</p>
<ol>
<li>Oracle的PL/SQL组件在对PL/SQL程序进行解释时，同时对在其所使用的表名、列名及数据类型进行检查。</li>
<li>PL/SQL可以在SQL*PLUS中使用。</li>
<li>PL/SQL可以在高级语言中是哟。</li>
<li>PL/SQL可以在Oracle的开发工具中使用。</li>
<li>其它开发工具也可以调用PL/SQL编写的过程和函数，如Power Builder等可以调用服务器端的PL/SQL过程。</li>
</ol>
<h3 id="运行PL-SQL程序"><a href="#运行PL-SQL程序" class="headerlink" title="运行PL/SQL程序"></a>运行PL/SQL程序</h3><p>PL/SQL程序的运行是通过Oracle中的一个引擎来进行的。这个引擎可能在Oracle的服务器端，也可能在oracle应用开发的客户端。引擎执行PL/SQL中的过程性语句，然后将SQL语句发送给数据库服务器来执行。再将结果返回给执行端。</p>
<h3 id="PL-SQL块"><a href="#PL-SQL块" class="headerlink" title="PL/SQL块"></a>PL/SQL块</h3><p>PL/SQL程序由三个块组成，即声明部分、执行部分、异常处理部分。PL/SQL块的结构如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line"><span class="comment">/* 声明部分：在此声明PL/SQL用到的变量，类型及游标，以及局部的存储过程和函数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="comment">/* 执行部分：过程及SQL语句，即程序的主要部分</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">EXCEPTION</span><br><span class="line"><span class="comment">/* 执行异常部分：错误处理</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
<p>其中，执行部分是必须的。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- DECLARE</span></span><br><span class="line"><span class="comment">-- 声明的变量、类型、游标</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="comment">-- 程序的执行部分</span></span><br><span class="line">DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;HelloWorld&#x27;</span>);</span><br><span class="line"><span class="comment">-- EXCEPTION</span></span><br><span class="line"><span class="comment">-- 针对BEGIN块中出现的异常，提供处理的机制</span></span><br><span class="line"><span class="comment">-- WHEN...THEN...</span></span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">   v_sal VARCHAR2(<span class="number">20</span>);</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">   <span class="keyword">SELECT</span></span><br><span class="line">      salary</span><br><span class="line">   <span class="keyword">INTO</span> v_sal</span><br><span class="line">   <span class="keyword">FROM</span> employees</span><br><span class="line">   <span class="keyword">WHERE</span> employee_id <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">   DBMS_OUTPUT.PUT_LINE(v_sal);</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">   v_sal employees.salary<span class="operator">%</span>type;</span><br><span class="line">   v_email VARCHAR2(<span class="number">20</span>);</span><br><span class="line">   v_hire_date <span class="type">DATE</span>;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">   <span class="keyword">SELECT</span></span><br><span class="line">      salary,</span><br><span class="line">      email,</span><br><span class="line">      hire_date</span><br><span class="line">   <span class="keyword">INTO</span></span><br><span class="line">      v_sal,</span><br><span class="line">      v_email,</span><br><span class="line">      v_hire_date</span><br><span class="line">   <span class="keyword">FROM</span> employees</span><br><span class="line">   <span class="keyword">WHERE</span> employee_id <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">   DBMS_OUTPUT.PUT_LINE(v_sal <span class="operator">||</span><span class="string">&#x27;,&#x27;</span> <span class="operator">||</span> v_email <span class="operator">||</span> <span class="string">&#x27;,&#x27;</span> <span class="operator">||</span> v_hire_date);</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
<h4 id="变量类型"><a href="#变量类型" class="headerlink" title="变量类型"></a>变量类型</h4><p>在Oracle8i中可以使用的变量类型有：<br>|      类型      |                            子类                             |                                                          说明                                                           |                   范围                   | Oracle限制 |<br>| :————: | :———————————————————: | :———————————————————————————————————————: | :————————————–: | :——–: |<br>|      CHAR      |                Character String Rowid Nchar                 |                                       Character定长字符串, Nchar为民族语言字符集                                        |           0<del>32767 可选，缺省=1           |    2000    |<br>|    VARCHAR2    |                  Varchar,String NVARCHAR2                   |                                               可变字符串，民族语言字符集                                                |               0</del>32767 4000               |    4000    |<br>| BINARY_INTEGER |                                                             |                                             带符号整数，为整数计算优化性能                                              |                                          |            |<br>|  NUMBER(p,s)   | Dec ；Double ；precision;Integer;Int;Numeric;Real;Small int | 小数，NUMBER的子类型高精度实数；整数，NUMBER的子类型 ;整数，NUMBER的子类型与NUMBER等价；与NUMBER等价；整数；比Integer小 |                                          |            |<br>|      LONG      |                                                             |                                                       变长字符串                                                        |               0~2147483647               | 32767字节  |<br>|      DATE      |                                                             |                                                         日期型                                                          | 公元前4712年1月1日至公元后4712年12月31日 |            |<br>|    BOOLEAN     |                           布尔型                            |                                                     TRUE,FALSE,NULL                                                     |                  不使用                  |<br>|     ROWID      |                                                             |                                                     存放数据库行号                                                      |                                          |            |<br>|     UROWID     |                                                             |                                                 通用行标识符，字符类型                                                  |                                          |            |</p>
<h3 id="复合类型"><a href="#复合类型" class="headerlink" title="复合类型"></a>复合类型</h3><p>Oracle在PL/SQL中除了提供像前面介绍的各种类型外，还提供一种称为复合类型的类型 —记录和表。</p>
<h4 id="记录类型"><a href="#记录类型" class="headerlink" title="记录类型"></a>记录类型</h4><p>记录类型是把逻辑相关的数据作为一个单元存储起来，称作PL/SQL RECORD的域(FIELD),其作用是存放互不相同但逻辑相关的信息。</p>
<p>定义记录类型语法如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">TYPE record_type <span class="keyword">IS</span> RECORD(</span><br><span class="line">   Field1 type1 [<span class="keyword">NOT</span> <span class="keyword">null</span>] [:<span class="operator">=</span>EXP1],</span><br><span class="line">   Field2 type2 [<span class="keyword">NOT</span> <span class="keyword">null</span>] [:<span class="operator">=</span>EXP2],</span><br><span class="line">   ... ...</span><br><span class="line">   Fieldn typen [<span class="keyword">NOT</span> <span class="keyword">null</span>] [:<span class="operator">=</span>EXPn]</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line"><span class="comment">-- 声明一个记录类型</span></span><br><span class="line">TYPE emp_record <span class="keyword">IS</span> RECORD(</span><br><span class="line">   v_sal employees.salary<span class="operator">%</span>type,</span><br><span class="line">   v_email employees.email<span class="operator">%</span>type,</span><br><span class="line">   v_hire_date employees.hire_date<span class="operator">%</span>type</span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 定义一个记录类型的成员变量</span></span><br><span class="line">v_emp_record emp_record;</span><br><span class="line"></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">   <span class="keyword">SELECT</span></span><br><span class="line">      salary,</span><br><span class="line">      email,</span><br><span class="line">      hire_date</span><br><span class="line">   <span class="keyword">INTO</span></span><br><span class="line">      v_emp_record</span><br><span class="line">   <span class="keyword">FROM</span> employees</span><br><span class="line">   <span class="keyword">WHERE</span> employee_id <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">   DBMS_OUTPUT.PUT_LINE(v_emp_record.v_sal <span class="operator">||</span><span class="string">&#x27;,&#x27;</span> <span class="operator">||</span> v_emp_record.v_email <span class="operator">||</span> <span class="string">&#x27;,&#x27;</span> <span class="operator">||</span> v_emp_record.v_hire_date);</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>Donate comment here</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt=" 微信支付"/>
        <p>微信支付</p>
      </div>
    

    

    

  </div>
</div>

      </div>
    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    NoTrouble
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://yoursite.com/2022/09/04/Oracle-SQL%E5%9F%BA%E7%A1%80%E4%B8%8EPL-SQL/" title="Oracle_SQL基础与PL/SQL">http://yoursite.com/2022/09/04/Oracle-SQL%E5%9F%BA%E7%A1%80%E4%B8%8EPL-SQL/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Oracle/" rel="tag"># Oracle</a>
          
            <a href="/tags/SQL/" rel="tag"># SQL</a>
          
            <a href="/tags/PL-SQL/" rel="tag"># PL/SQL</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2021/12/02/Redis%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="next" title="Redis中的数据结构">
                <i class="fa fa-chevron-left"></i> Redis中的数据结构
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2023/07/22/Linear-Model/" rel="prev" title="Linear_Model">
                Linear_Model <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
    

  


    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC81MDk0MC8yNzQyMg=="></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/wk.jpg"
                alt="" />
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">119</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">30</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">50</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/NoTrouble-EL" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:wukun0221@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          <script type="text/javascript" src="//rf.revolvermaps.com/0/0/8.js?i=5clr89hn3fz&amp;m=0&amp;c=ff0000&amp;cr1=ffffff&amp;f=arial&amp;l=33&amp;s=340" async="async"></script>

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%9F%BA%E6%9C%AC%E7%9A%84SQL-SELECT%E8%AF%AD%E5%8F%A5"><span class="nav-number">1.</span> <span class="nav-text">1.基本的SQL-SELECT语句</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%ACSELECT%E8%AF%AD%E5%8F%A5"><span class="nav-number">1.1.</span> <span class="nav-text">基本SELECT语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E7%A9%BA%E5%80%BC"><span class="nav-number">1.2.</span> <span class="nav-text">定义空值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%97%E7%9A%84%E5%88%AB%E5%90%8D"><span class="nav-number">1.3.</span> <span class="nav-text">列的别名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5%E7%AC%A6"><span class="nav-number">1.4.</span> <span class="nav-text">连接符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">1.5.</span> <span class="nav-text">字符串</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8D%E5%A4%8D%E8%A1%8C"><span class="nav-number">1.6.</span> <span class="nav-text">重复行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SQL-Plus%E5%91%BD%E4%BB%A4"><span class="nav-number">1.7.</span> <span class="nav-text">SQL*Plus命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%8F%E8%BF%B0%E8%A1%A8%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">1.8.</span> <span class="nav-text">描述表的结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E8%8A%82%E6%B5%8B%E8%AF%95"><span class="nav-number">1.9.</span> <span class="nav-text">第一节测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E8%BF%87%E6%BB%A4%E5%92%8C%E6%8E%92%E5%BA%8F%E6%95%B0%E6%8D%AE"><span class="nav-number">2.</span> <span class="nav-text">2.过滤和排序数据</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97"><span class="nav-number">2.1.</span> <span class="nav-text">比较运算</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B6%E5%AE%83%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="nav-number">2.2.</span> <span class="nav-text">其它比较运算符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97"><span class="nav-number">2.3.</span> <span class="nav-text">逻辑运算</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ORDER-BY%E5%AD%90%E5%8F%A5"><span class="nav-number">2.4.</span> <span class="nav-text">ORDER BY子句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E8%8A%82%E6%80%BB%E7%BB%93"><span class="nav-number">2.5.</span> <span class="nav-text">第二节总结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E8%8A%82%E6%B5%8B%E8%AF%95"><span class="nav-number">2.6.</span> <span class="nav-text">第二节测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E5%8D%95%E8%A1%8C%E5%87%BD%E6%95%B0"><span class="nav-number">3.</span> <span class="nav-text">3.单行函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E5%87%BD%E6%95%B0"><span class="nav-number">3.1.</span> <span class="nav-text">字符函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%A7%E5%B0%8F%E5%86%99%E6%8E%A7%E5%88%B6%E5%87%BD%E6%95%B0"><span class="nav-number">3.1.1.</span> <span class="nav-text">大小写控制函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E6%8E%A7%E5%88%B6%E5%87%BD%E6%95%B0"><span class="nav-number">3.1.2.</span> <span class="nav-text">字符控制函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E5%AD%97%E5%87%BD%E6%95%B0"><span class="nav-number">3.1.3.</span> <span class="nav-text">数字函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%97%A5%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="nav-number">3.1.4.</span> <span class="nav-text">日期函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BD%AC%E6%8D%A2%E5%87%BD%E6%95%B0"><span class="nav-number">3.1.5.</span> <span class="nav-text">转换函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%9A%E7%94%A8%E5%87%BD%E6%95%B0"><span class="nav-number">3.1.6.</span> <span class="nav-text">通用函数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%A1%E4%BB%B6%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-number">3.2.</span> <span class="nav-text">条件表达式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="nav-number">4.</span> <span class="nav-text">4.多表查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF"><span class="nav-number">4.1.</span> <span class="nav-text">笛卡尔积</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5"><span class="nav-number">4.2.</span> <span class="nav-text">连接</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%86%85%E8%BF%9E%E6%8E%A5"><span class="nav-number">4.2.1.</span> <span class="nav-text">内连接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="nav-number">4.2.2.</span> <span class="nav-text">外连接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%87%AA%E7%84%B6%E8%BF%9E%E6%8E%A5"><span class="nav-number">4.2.3.</span> <span class="nav-text">自然连接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%A8%E8%BF%9E%E6%8E%A5"><span class="nav-number">4.2.4.</span> <span class="nav-text">全连接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%87%AA%E8%BF%9E%E6%8E%A5"><span class="nav-number">4.2.5.</span> <span class="nav-text">自连接</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="nav-number">5.</span> <span class="nav-text">5.聚合函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#AVG%E3%80%81SUM%E5%87%BD%E6%95%B0"><span class="nav-number">5.1.</span> <span class="nav-text">AVG、SUM函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MIN%E3%80%81MAX%E5%87%BD%E6%95%B0"><span class="nav-number">5.2.</span> <span class="nav-text">MIN、MAX函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#COUNT%E5%87%BD%E6%95%B0"><span class="nav-number">5.3.</span> <span class="nav-text">COUNT函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%81%9A%E5%90%88%E6%95%B0%E6%8D%AE"><span class="nav-number">5.4.</span> <span class="nav-text">聚合数据</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-number">6.</span> <span class="nav-text">6.子查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2%E8%AF%AD%E6%B3%95"><span class="nav-number">6.1.</span> <span class="nav-text">子查询语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%95%E8%A1%8C%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-number">6.2.</span> <span class="nav-text">单行子查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E8%A1%8C%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-number">6.3.</span> <span class="nav-text">多行子查询</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-%E5%88%9B%E5%BB%BA%E5%92%8C%E7%AE%A1%E7%90%86%E8%A1%A8"><span class="nav-number">7.</span> <span class="nav-text">7.创建和管理表</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AF%B9%E8%B1%A1"><span class="nav-number">7.1.</span> <span class="nav-text">常见的数据库对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99"><span class="nav-number">7.2.</span> <span class="nav-text">命名规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%A1%A8"><span class="nav-number">7.3.</span> <span class="nav-text">创建表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E8%A1%A8"><span class="nav-number">7.4.</span> <span class="nav-text">修改表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E8%A1%A8"><span class="nav-number">7.5.</span> <span class="nav-text">删除表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%85%E7%A9%BA%E8%A1%A8"><span class="nav-number">7.6.</span> <span class="nav-text">清空表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%94%B9%E8%A1%A8%E5%90%8D"><span class="nav-number">7.7.</span> <span class="nav-text">改表名</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86"><span class="nav-number">8.</span> <span class="nav-text">8.数据处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E6%93%8D%E7%BA%B5%E8%AF%AD%E8%A8%80"><span class="nav-number">8.1.</span> <span class="nav-text">数据操纵语言</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="nav-number">8.2.</span> <span class="nav-text">插入数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE"><span class="nav-number">8.3.</span> <span class="nav-text">更新数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="nav-number">8.4.</span> <span class="nav-text">删除数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1"><span class="nav-number">8.5.</span> <span class="nav-text">数据库事务</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9B%9E%E6%BB%9A%E5%88%B0%E4%BF%9D%E5%AD%98%E7%82%B9"><span class="nav-number">8.5.1.</span> <span class="nav-text">回滚到保存点</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-%E7%BA%A6%E6%9D%9F"><span class="nav-number">9.</span> <span class="nav-text">9.约束</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#NOT-NULL%E7%BA%A6%E6%9D%9F"><span class="nav-number">9.1.</span> <span class="nav-text">NOT NULL约束</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UNIQUE%E7%BA%A6%E6%9D%9F"><span class="nav-number">9.2.</span> <span class="nav-text">UNIQUE约束</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BB%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="nav-number">9.3.</span> <span class="nav-text">主键约束</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="nav-number">9.4.</span> <span class="nav-text">外键约束</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A3%80%E6%9F%A5%E7%BA%A6%E6%9D%9F"><span class="nav-number">9.5.</span> <span class="nav-text">检查约束</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E7%BA%A6%E6%9D%9F%E7%9A%84%E8%AF%AD%E6%B3%95"><span class="nav-number">9.6.</span> <span class="nav-text">添加约束的语法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E6%88%96%E5%88%A0%E9%99%A4%E7%BA%A6%E6%9D%9F"><span class="nav-number">9.6.1.</span> <span class="nav-text">添加或删除约束</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%97%A0%E6%95%88%E5%8C%96%E7%BA%A6%E6%9D%9F"><span class="nav-number">9.6.2.</span> <span class="nav-text">无效化约束</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%89%E6%95%88%E5%8C%96%E7%BA%A6%E6%9D%9F"><span class="nav-number">9.6.3.</span> <span class="nav-text">有效化约束</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E7%BA%A6%E6%9D%9F"><span class="nav-number">9.7.</span> <span class="nav-text">查询约束</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E5%AE%9A%E4%B9%89%E7%BA%A6%E6%9D%9F%E7%9A%84%E5%88%97"><span class="nav-number">9.8.</span> <span class="nav-text">查询定义约束的列</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-%E8%A7%86%E5%9B%BE"><span class="nav-number">10.</span> <span class="nav-text">10.视图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%A7%86%E5%9B%BE"><span class="nav-number">10.1.</span> <span class="nav-text">创建视图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E8%A7%86%E5%9B%BE"><span class="nav-number">10.2.</span> <span class="nav-text">查询视图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E8%A7%86%E5%9B%BE"><span class="nav-number">10.3.</span> <span class="nav-text">修改视图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E8%A7%86%E5%9B%BE"><span class="nav-number">10.4.</span> <span class="nav-text">删除视图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B1%8F%E8%94%BDDML%E6%93%8D%E4%BD%9C"><span class="nav-number">10.5.</span> <span class="nav-text">屏蔽DML操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Top-N%E5%88%86%E6%9E%90"><span class="nav-number">10.6.</span> <span class="nav-text">Top-N分析</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-%E5%85%B6%E5%AE%83%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AF%B9%E8%B1%A1"><span class="nav-number">11.</span> <span class="nav-text">11.其它数据库对象</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%8F%E5%88%97"><span class="nav-number">11.1.</span> <span class="nav-text">序列</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%BA%8F%E5%88%97"><span class="nav-number">11.1.1.</span> <span class="nav-text">什么是序列</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%BA%8F%E5%88%97"><span class="nav-number">11.1.2.</span> <span class="nav-text">创建序列</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E5%BA%8F%E5%88%97"><span class="nav-number">11.1.3.</span> <span class="nav-text">修改序列</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%BA%8F%E5%88%97"><span class="nav-number">11.1.4.</span> <span class="nav-text">使用序列</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E5%BA%8F%E5%88%97"><span class="nav-number">11.1.5.</span> <span class="nav-text">查询序列</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E5%BA%8F%E5%88%97"><span class="nav-number">11.1.6.</span> <span class="nav-text">删除序列</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95"><span class="nav-number">11.2.</span> <span class="nav-text">索引</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="nav-number">11.2.1.</span> <span class="nav-text">创建索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E7%B4%A2%E5%BC%95"><span class="nav-number">11.2.2.</span> <span class="nav-text">查询索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="nav-number">11.2.3.</span> <span class="nav-text">删除索引</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%8C%E4%B9%89%E8%AF%8D-SYNONYM"><span class="nav-number">11.3.</span> <span class="nav-text">同义词-SYNONYM</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%92%8C%E5%88%A0%E9%99%A4%E5%90%8C%E4%B9%89%E8%AF%8D"><span class="nav-number">11.3.1.</span> <span class="nav-text">创建和删除同义词</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-%E6%8E%A7%E5%88%B6%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90"><span class="nav-number">12.</span> <span class="nav-text">12.控制用户权限</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%83%E9%99%90"><span class="nav-number">12.1.</span> <span class="nav-text">权限</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7"><span class="nav-number">12.1.1.</span> <span class="nav-text">创建用户</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%A8%E6%88%B7%E7%9A%84%E7%B3%BB%E7%BB%9F%E6%9D%83%E9%99%90"><span class="nav-number">12.1.2.</span> <span class="nav-text">用户的系统权限</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E8%A1%A8%E7%A9%BA%E9%97%B4"><span class="nav-number">12.1.3.</span> <span class="nav-text">创建用户表空间</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%A7%92%E8%89%B2%E5%B9%B6%E8%B5%8B%E4%BA%88%E6%9D%83%E9%99%90"><span class="nav-number">12.1.4.</span> <span class="nav-text">创建角色并赋予权限</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%B9%E8%B1%A1%E6%9D%83%E9%99%90"><span class="nav-number">12.2.</span> <span class="nav-text">对象权限</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-%E9%9B%86%E5%90%88%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="nav-number">13.</span> <span class="nav-text">13.集合运算符</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#UNION-%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="nav-number">13.1.</span> <span class="nav-text">UNION 操作符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#INTERSECT-%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="nav-number">13.2.</span> <span class="nav-text">INTERSECT 操作符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MINUS%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="nav-number">13.3.</span> <span class="nav-text">MINUS操作符</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-%E9%AB%98%E7%BA%A7%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-number">14.</span> <span class="nav-text">14.高级子查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-number">14.1.</span> <span class="nav-text">子查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E5%88%97%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-number">14.2.</span> <span class="nav-text">多列子查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%95%E5%88%97%E5%AD%90%E6%9F%A5%E8%AF%A2%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-number">14.3.</span> <span class="nav-text">单列子查询表达式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-number">14.4.</span> <span class="nav-text">相关子查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#EXISTS%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="nav-number">14.5.</span> <span class="nav-text">EXISTS操作符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3%E6%9B%B4%E6%96%B0"><span class="nav-number">14.6.</span> <span class="nav-text">相关更新</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3%E5%88%A0%E9%99%A4"><span class="nav-number">14.7.</span> <span class="nav-text">相关删除</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WITH%E5%AD%90%E5%8F%A5"><span class="nav-number">14.8.</span> <span class="nav-text">WITH子句</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PL-SQL%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1"><span class="nav-number">15.</span> <span class="nav-text">PL&#x2F;SQL程序设计</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SQL%E4%B8%8EPL-SQL"><span class="nav-number">15.1.</span> <span class="nav-text">SQL与PL&#x2F;SQL</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFPL-SQL"><span class="nav-number">15.1.1.</span> <span class="nav-text">什么是PL&#x2F;SQL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PL-SQL%E5%8F%AF%E7%94%A8%E7%9A%84SQL%E8%AF%AD%E8%A8%80"><span class="nav-number">15.1.2.</span> <span class="nav-text">PL&#x2F;SQL可用的SQL语言</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%90%E8%A1%8CPL-SQL%E7%A8%8B%E5%BA%8F"><span class="nav-number">15.2.</span> <span class="nav-text">运行PL&#x2F;SQL程序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PL-SQL%E5%9D%97"><span class="nav-number">15.3.</span> <span class="nav-text">PL&#x2F;SQL块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%98%E9%87%8F%E7%B1%BB%E5%9E%8B"><span class="nav-number">15.3.1.</span> <span class="nav-text">变量类型</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%8D%E5%90%88%E7%B1%BB%E5%9E%8B"><span class="nav-number">15.4.</span> <span class="nav-text">复合类型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%B0%E5%BD%95%E7%B1%BB%E5%9E%8B"><span class="nav-number">15.4.1.</span> <span class="nav-text">记录类型</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">NoTrouble</span>

  
</div>





            <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

  

  <script async src="/js/cursor/text.js"></script>


</body>
</html>

<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>
